document.addEventListener("DOMContentLoaded",function(){function st(){function f(n,t){return function(){const i=this,u=arguments;clearTimeout(r);r=setTimeout(()=>{n.apply(i,u)},t)}}function e(){i||(t=!t,i=!0,requestAnimationFrame(()=>{t?n.mobileSongsContainer.classList.add("collapsed"):n.mobileSongsContainer.classList.remove("collapsed"),setTimeout(()=>{i=!1},320)}))}if(n.mobileSongsCollapse&&n.mobileSongsContainer){let t=!1,i=!1,r=null;const u=f(e,30);n.mobileSongsCollapse.addEventListener("click",function(){u()});n.mobileSongsContainer.querySelector(".songs-header").addEventListener("click",function(n){n.target.closest(".collapse-btn")||u()})}}function ht(){"IntersectionObserver"in window?(window.imageObserver=new IntersectionObserver((n,t)=>{n.forEach(n=>{if(n.isIntersecting){const i=n.target,r=i.getAttribute("data-src");r&&(i.src=r,i.removeAttribute("data-src"),i.onload=()=>{i.style.opacity="0",i.style.transition="opacity 0.3s",i.classList.add("lazy-loaded"),requestAnimationFrame(()=>{i.style.opacity="1"})},t.unobserve(i))}})},{rootMargin:"50px 0px",threshold:.01}),document.querySelectorAll("img[data-src]").forEach(n=>{window.imageObserver.observe(n)})):ct()}function ct(){function n(){r.forEach(n=>{if(n.getAttribute("data-src")){const t=n.getBoundingClientRect(),i=t.top<=window.innerHeight&&t.bottom>=0&&t.left<=window.innerWidth&&t.right>=0;if(i){const t=n.getAttribute("data-src");n.src=t;n.removeAttribute("data-src");n.onload=()=>{n.style.opacity="0",n.style.transition="opacity 0.3s",n.classList.add("lazy-loaded"),requestAnimationFrame(()=>{n.style.opacity="1"})}}}});const t=document.querySelectorAll("img[data-src]");t.length===0&&(window.removeEventListener("scroll",n),window.removeEventListener("resize",n))}const r=document.querySelectorAll("img[data-src]");n();let t;window.addEventListener("scroll",()=>{t&&clearTimeout(t),t=setTimeout(()=>{n()},200)});let i;window.addEventListener("resize",()=>{i&&clearTimeout(i),i=setTimeout(()=>{n()},200)})}function lt(){musicAlbums&&musicAlbums.length>0&&(n.albumsList.innerHTML="",neteasePlaylists&&neteasePlaylists.length>0&&neteasePlaylists.forEach(t=>{const i=document.createElement("div");i.className="album-item";i.dataset.id=t.id;i.innerHTML=`
                                <div class="album-image">
                                    <img data-src="${t.cover}" alt="${t.name}" loading="lazy">
                                </div>
                                <div class="album-info">
                                    <h3 class="album-title">${t.name}</h3>
                                </div>
                            `;i.addEventListener("click",()=>{w(t.id)});n.albumsList.appendChild(i)}),musicAlbums.forEach(t=>{const i=document.createElement("div");i.className="album-item";i.dataset.id=t.id;i.innerHTML=`
                            <div class="album-image">
                                <img data-src="${t.cover}" alt="${t.name}" loading="lazy">
                            </div>
                            <div class="album-info">
                                <h3 class="album-title">${t.name}</h3>
                            </div>
                        `;i.addEventListener("click",()=>{w(t.id)});n.albumsList.appendChild(i)}),ht(),at())}function at(){const t=n.albumsList.querySelectorAll(".album-item");t.forEach((n,t)=>{n.style.animation="none",n.style.opacity="0",void n.offsetWidth,n.style.animation=`bounceIn 0.6s ease-out ${t*.1}s both`})}function w(t){if(t===h){if(h=null,r=[],musicAlbums.forEach(n=>{n.songs&&Array.isArray(n.songs)&&r.push(...n.songs)}),g(),nt(),r.length>0){const t=n.audioPlayer.src,i=r.some(n=>n.src===t);i||(u=0,l(r[u]),o&&n.audioPlayer.addEventListener("loadedmetadata",function i(){e();n.audioPlayer.removeEventListener("loadedmetadata",i)}))}}else if(t.startsWith("netease_playlist_")){h=t;const i=neteasePlaylists.find(n=>n.id===t);if(!i){n.songsListDesktop.innerHTML='<div class="song-item"><div class="song-details"><div class="song-name">未找到网易云歌单配置<\/div><\/div><\/div>';n.songsListMobile.innerHTML='<div class="song-item"><div class="song-details"><div class="song-name">未找到网易云歌单配置<\/div><\/div><\/div>';return}n.songsListDesktop.innerHTML='<div class="song-item"><div class="song-details"><div class="song-name">正在加载网易云歌单...<\/div><\/div><\/div>';n.songsListMobile.innerHTML='<div class="song-item"><div class="song-details"><div class="song-name">正在加载网易云歌单...<\/div><\/div><\/div>';fetch("https://music.zhheo.com/meting-api/?server=netease&type=playlist&id="+i.playlistId+"&r="+Math.random()).then(n=>n.json()).then(t=>{if(t&&t.length>0){if(r=t.map((n,t)=>({name:n.name||"未知歌曲",artist:n.artist||"未知艺术家",src:n.url||"",cover:n.pic||"img/default.jpg",id:`netease_${i.id}_${t}`,neteaseId:n.id,lrc:n.lrc})),g(),nt(),r.length>0){const t=n.audioPlayer.src,i=r.some(n=>n.src===t);i||(u=0,l(r[u]),o&&n.audioPlayer.addEventListener("loadedmetadata",function f(){e();n.audioPlayer.removeEventListener("loadedmetadata",f)}))}}else n.songsListDesktop.innerHTML='<div class="song-item"><div class="song-details"><div class="song-name">加载网易云歌单失败<\/div><\/div><\/div>',n.songsListMobile.innerHTML='<div class="song-item"><div class="song-details"><div class="song-name">加载网易云歌单失败<\/div><\/div><\/div>'}).catch(t=>{console.error("加载网易云歌单失败:",t),n.songsListDesktop.innerHTML='<div class="song-item"><div class="song-details"><div class="song-name">加载网易云歌单失败<\/div><\/div><\/div>',n.songsListMobile.innerHTML='<div class="song-item"><div class="song-details"><div class="song-name">加载网易云歌单失败<\/div><\/div><\/div>'})}else{if(h=t,musicAlbums){const n=musicAlbums.find(n=>n.id===t);n&&(r=[...n.songs])}if(g(),nt(),r.length>0){const t=n.audioPlayer.src,i=r.some(n=>n.src===t);i||(u=0,l(r[u]),o&&n.audioPlayer.addEventListener("loadedmetadata",function i(){e();n.audioPlayer.removeEventListener("loadedmetadata",i)}))}}}function g(){const t=n.songsListDesktop,i=n.songsListMobile;t.style.animation="none";i.style.animation="none";void t.offsetWidth;void i.offsetWidth;t.style.animation="slideInUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)";i.style.animation="slideInUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)"}function nt(){if(n.songsListDesktop.innerHTML="",n.songsListMobile.innerHTML="",r.length===0){const t=document.createElement("div");t.className="song-item";t.innerHTML=`
                        <div class="song-details">
                            <div class="song-name">暂无歌曲</div>
                        </div>
                    `;n.songsListDesktop.appendChild(t);n.songsListMobile.appendChild(t.cloneNode(!0));return}const t=document.createDocumentFragment(),i=document.createDocumentFragment();r.forEach((r,f)=>{const o=n.audioPlayer.src.includes(r.src);o&&(u=f);const s=`
                        <div class="song-number">${f+1}</div>
                        <div class="song-details">
                            <div class="song-name">${r.name}</div>
                            <div class="song-artist-name">${r.artist||r.id}</div>
                        </div>
                    `,e=document.createElement("div");e.className="song-item";e.dataset.index=f;o&&e.classList.add("active");e.innerHTML=s;t.appendChild(e);const h=e.cloneNode(!0);i.appendChild(h)});n.songsListDesktop.appendChild(t);n.songsListMobile.appendChild(i);vt()}function vt(){const t=n.songsListDesktop.querySelectorAll(".song-item"),i=n.songsListMobile.querySelectorAll(".song-item");[...t,...i].forEach((n,t)=>{n.style.animation="none",n.style.opacity="0",void n.offsetWidth,n.style.animation=`fadeInRight 0.5s ease-out ${t*.05}s both`})}function yt(){if(n.songsListDesktop.innerHTML="",n.songsListMobile.innerHTML="",r.length===0){const t=document.createElement("div");t.className="song-item";t.innerHTML=`
                        <div class="song-details">
                            <div class="song-name">暂无歌曲</div>
                        </div>
                    `;n.songsListDesktop.appendChild(t);n.songsListMobile.appendChild(t.cloneNode(!0));return}const t=document.createDocumentFragment(),i=document.createDocumentFragment();r.forEach((r,f)=>{const o=n.audioPlayer.src.includes(r.src);o&&(u=f);const s=`
                        <div class="song-number">${f+1}</div>
                        <div class="song-details">
                            <div class="song-name">${r.name}</div>
                            <div class="song-artist-name">${r.artist||r.id}</div>
                        </div>
                    `,e=document.createElement("div");e.className="song-item";e.dataset.index=f;o&&e.classList.add("active");e.innerHTML=s;t.appendChild(e);const h=e.cloneNode(!0);i.appendChild(h)});n.songsListDesktop.appendChild(t);n.songsListMobile.appendChild(i)}function it(t){const f=t.target.closest(".song-item");if(f){const i=parseInt(f.dataset.index);isNaN(i)||i<0||i>=r.length||(u=i,tt(),l(r[u]),n.audioPlayer.addEventListener("loadedmetadata",function o(){s();e();n.audioPlayer.removeEventListener("loadedmetadata",o)}),n.audioPlayer.addEventListener("error",function h(){s();b("音频加载失败，请检查网络连接");n.audioPlayer.removeEventListener("error",h)}))}}function tt(){if(n.playPauseBtn.classList.add("loading"),n.playIcon.style.display="none",n.pauseIcon.style.display="none",!n.playPauseBtn.querySelector(".loading-indicator")){const t=document.createElement("div");t.className="loading-indicator";t.innerHTML='<i class="fa fa-spinner fa-spin"><\/i>';n.playPauseBtn.appendChild(t)}}function s(){n.playPauseBtn.classList.remove("loading");const t=n.playPauseBtn.querySelector(".loading-indicator");t&&t.remove();o?(n.playIcon.style.display="none",n.pauseIcon.style.display="block"):(n.playIcon.style.display="block",n.pauseIcon.style.display="none")}function b(n){const t=document.createElement("div");t.className="error-toast";t.innerHTML=`
                    <i class="fa fa-exclamation-circle"></i>
                    <span>${n}</span>
                `;document.body.appendChild(t);setTimeout(()=>{t.classList.add("fade-out"),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},300)},3e3)}function l(t){if(t){tt();n.songTitleElement.textContent=t.name;n.songArtistElement.textContent=t.artist||t.id;n.lyricsSongTitleElement.textContent=t.name;n.lyricsSongArtistElement.textContent=t.artist||t.id;let i="img/1.jpg";if(t.cover)i=t.cover;else if(h&&musicAlbums){const n=musicAlbums.find(n=>n.id===h);if(n&&n.cover)i=n.cover;else for(const n of musicAlbums)if(n.songs&&n.songs.some(n=>n.src===t.src)&&n.cover){i=n.cover;break}}i!=="img/default.jpg"?(n.coverImage.removeAttribute("src"),n.coverImage.setAttribute("data-src",i),pt(n.coverImage)?(n.coverImage.src=i,n.coverImage.removeAttribute("data-src"),n.coverImage.onload=()=>{n.coverImage.style.opacity="0",n.coverImage.style.transition="opacity 0.3s",n.coverImage.classList.add("lazy-loaded"),requestAnimationFrame(()=>{n.coverImage.style.opacity="1"})}):window.imageObserver?window.imageObserver.observe(n.coverImage):(n.coverImage.src=i,n.coverImage.removeAttribute("data-src"),n.coverImage.onload=()=>{n.coverImage.style.opacity="0",n.coverImage.style.transition="opacity 0.3s",n.coverImage.classList.add("lazy-loaded"),requestAnimationFrame(()=>{n.coverImage.style.opacity="1"})})):n.coverImage.src=i;n.audioPlayer.src=t.src;bt();si(t.name,h);ft();p&&n.audioPlayer.removeEventListener("error",p);y&&n.audioPlayer.removeEventListener("loadedmetadata",y);p=wt;n.audioPlayer.addEventListener("error",p);y=function(){s();ti()};n.audioPlayer.addEventListener("loadedmetadata",y)}}function pt(n){const t=n.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}function wt(n){s();const t=n.target.error;let i="音频加载失败";switch(t.code){case t.MEDIA_ERR_ABORTED:i="音频加载被中止";break;case t.MEDIA_ERR_NETWORK:i="网络错误，音频加载失败";break;case t.MEDIA_ERR_DECODE:i="音频解码失败";break;case t.MEDIA_ERR_SRC_NOT_SUPPORTED:i="音频格式不支持";break;default:i="音频加载失败，请检查网络连接"}b(i);console.error("音频加载错误:",t)}function bt(){const n=document.querySelectorAll(".song-item.active");n.forEach(n=>n.classList.remove("active"));const t=document.querySelectorAll(`.song-item[data-index="${u}"]`);t.forEach(n=>n.classList.add("active"))}function e(){if(r.length!==0){tt();const t=n.audioPlayer.play();if(t!==undefined)t.then(()=>{s(),o=!0,n.playIcon.style.display="none",n.pauseIcon.style.display="block",n.albumCover.classList.add("playing")}).catch(n=>{s();console.error("播放失败:",n);let t="播放失败";t=n.name==="NotAllowedError"?"浏览器阻止了自动播放，请点击播放按钮":n.name==="NotSupportedError"?"音频格式不支持":"播放失败，请重试";b(t)});else try{n.audioPlayer.play();o=!0;n.playIcon.style.display="none";n.pauseIcon.style.display="block";n.albumCover.classList.add("playing");s()}catch(i){s();console.error("播放失败:",i);b("播放失败，请重试")}}}function kt(){n.audioPlayer.pause();o=!1;n.playIcon.style.display="block";n.pauseIcon.style.display="none";n.albumCover.classList.remove("playing")}function rt(){if(r.length!==0){if(f===1){const n=Math.floor(Math.random()*r.length);u=n}else f===2||(u=(u+1)%r.length);f!==2?(l(r[u]),n.audioPlayer.addEventListener("loadedmetadata",function t(){e();n.audioPlayer.removeEventListener("loadedmetadata",t)})):e()}}function dt(){if(r.length!==0){if(f===1){const n=Math.floor(Math.random()*r.length);u=n}else f===2||(u=(u-1+r.length)%r.length);f!==2?(l(r[u]),n.audioPlayer.addEventListener("loadedmetadata",function t(){e();n.audioPlayer.removeEventListener("loadedmetadata",t)})):e()}}function gt(){const{duration:t,currentTime:i}=n.audioPlayer;if(t&&!isNaN(t)){const r=i/t*100;n.progress.style.width=`${r}%`}ni();et()}function ni(){const t=n.audioPlayer.currentTime;n.currentTimeElement.textContent=ut(t)}function ti(){const t=n.audioPlayer.duration;t&&!isNaN(t)&&(n.totalTimeElement.textContent=ut(t))}function ut(n){const t=Math.floor(n/60),i=Math.floor(n%60);return`${t.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`}function ii(t){const r=n.progressBar.clientWidth,u=n.progressBar.getBoundingClientRect(),f=t.clientX-u.left,i=n.audioPlayer.duration;if(i){const t=f/r*i;n.audioPlayer.currentTime=t}}function ri(){f=(f+1)%4;switch(f){case 0:n.modeIcon.innerHTML='<path d="M8 20V21.9324C8 22.2086 7.77614 22.4324 7.5 22.4324C7.38303 22.4324 7.26977 22.3914 7.17991 22.3165L3.06093 18.8841C2.84879 18.7073 2.82013 18.392 2.99691 18.1799C3.09191 18.0659 3.23264 18 3.38103 18L18 18C19.1046 18 20 17.1045 20 16V7.99997H22V16C22 18.2091 20.2091 20 18 20H8ZM16 3.99997V2.0675C16 1.79136 16.2239 1.5675 16.5 1.5675C16.617 1.5675 16.7302 1.60851 16.8201 1.68339L20.9391 5.11587C21.1512 5.29266 21.1799 5.60794 21.0031 5.82008C20.9081 5.93407 20.7674 5.99998 20.619 5.99998L6 5.99997C4.89543 5.99997 4 6.8954 4 7.99997V16H2V7.99997C2 5.79083 3.79086 3.99997 6 3.99997H16Z"/>';n.playModeBtn.style.backgroundColor="transparent";n.playModeBtn.style.color="var(--text-secondary)";break;case 1:n.modeIcon.innerHTML='<path d="M17 3.99998V2.0675C17 1.79136 17.2239 1.5675 17.5 1.5675C17.617 1.5675 17.7302 1.60851 17.8201 1.68339L21.9391 5.11587C22.1512 5.29266 22.1799 5.60794 22.0031 5.82008C21.9081 5.93407 21.7674 5.99998 21.619 5.99998H2V3.99998H17ZM2 18H22V20H2V18ZM2 11H22V13H2V11Z"/>';n.playModeBtn.style.backgroundColor="transparent";n.playModeBtn.style.color="var(--text-secondary)";const t=n.playModeBtn.querySelector(".loop-dot");t&&t.remove();break;case 2:n.modeIcon.innerHTML='<path d="M18 17.8832V16L23 19L18 22V19.9095C14.9224 19.4698 12.2513 17.4584 11.0029 14.5453L11 14.5386L10.9971 14.5453C9.57893 17.8544 6.32508 20 2.72483 20H2V18H2.72483C5.52503 18 8.05579 16.3312 9.15885 13.7574L9.91203 12L9.15885 10.2426C8.05579 7.66878 5.52503 6 2.72483 6H2V4H2.72483C6.32508 4 9.57893 6.14557 10.9971 9.45473L11 9.46141L11.0029 9.45473C12.2513 6.5416 14.9224 4.53022 18 4.09051V2L23 5L18 8V6.11684C15.7266 6.53763 13.7737 8.0667 12.8412 10.2426L12.088 12L12.8412 13.7574C13.7737 15.9333 15.7266 17.4624 18 17.8832Z"/>';n.playModeBtn.style.backgroundColor="transparent";n.playModeBtn.style.color="var(--text-secondary)";break;case 3:n.modeIcon.innerHTML='<path d="M8 20V21.9325C8 22.2086 7.77614 22.4325 7.5 22.4325C7.38303 22.4325 7.26977 22.3915 7.17991 22.3166L3.06093 18.8841C2.84879 18.7073 2.82013 18.392 2.99691 18.1799C3.09191 18.0659 3.23264 18 3.38103 18L18 18C19.1046 18 20 17.1046 20 16V8H22V16C22 18.2091 20.2091 20 18 20H8ZM16 2.0675C16 1.79136 16.2239 1.5675 16.5 1.5675C16.617 1.5675 16.7302 1.60851 16.8201 1.68339L20.9391 5.11587C21.1512 5.29266 21.1799 5.60794 21.0031 5.82008C20.9081 5.93407 20.7674 5.99998 20.619 5.99998L6 6C4.89543 6 4 6.89543 4 8V16H2V8C2 5.79086 3.79086 4 6 4H16V2.0675ZM11 8H13V16H11V10H9V9L11 8Z"/>';n.playModeBtn.style.backgroundColor="transparent";n.playModeBtn.style.color="var(--text-secondary)"}}function ui(){const n=document.createElement("div");n.className="qr-modal";n.innerHTML=`
                    <div class="qr-modal-content">
                        <div class="qr-modal-header">
                            <h3>上传歌曲至网易云盘</h3>
                            <button class="qr-modal-close">&times;</button>
                        </div>
                        <div class="qr-modal-body">
                            <img src="img/xcx.jpg" alt="云盘二维码" class="qr-code-image">
                            <p>扫码使用小程序上传歌曲</p>
                            <p><a href="https://mp.weixin.qq.com/s/pHsFSPTn3Cd7MXV81J4NHg" target="_blank">使用指南</a></p>
                        </div>
                    </div>
                `;document.body.appendChild(n);const t=n.querySelector(".qr-modal-close");t.addEventListener("click",function(){const t=n.querySelector(".qr-modal-content");t.style.animation="modalBounceOut 0.4s ease-in forwards";setTimeout(()=>{document.body.removeChild(n)},400)});n.addEventListener("click",function(t){if(t.target===n){const t=n.querySelector(".qr-modal-content");t.style.animation="modalBounceOut 0.4s ease-in forwards";setTimeout(()=>{document.body.removeChild(n)},400)}})}function fi(){t.playPause&&n.playPauseBtn.removeEventListener("click",t.playPause);t.prev&&n.prevBtn.removeEventListener("click",t.prev);t.next&&n.nextBtn.removeEventListener("click",t.next);t.playMode&&n.playModeBtn.removeEventListener("click",t.playMode);t.cloud&&n.cloudBtn.removeEventListener("click",t.cloud);t.timeupdate&&n.audioPlayer.removeEventListener("timeupdate",t.timeupdate);t.progressClick&&n.progressBar.removeEventListener("click",t.progressClick);t.ended&&n.audioPlayer.removeEventListener("ended",t.ended);t.albumCover&&n.albumCover.removeEventListener("click",t.albumCover);t.songClickDesktop&&n.songsListDesktop.removeEventListener("click",t.songClickDesktop);t.songClickMobile&&n.songsListMobile.removeEventListener("click",t.songClickMobile)}function ei(){t.playPause=()=>{n.playPauseBtn.classList.contains("loading")||(o?kt():e())};n.playPauseBtn.addEventListener("click",t.playPause);t.prev=dt;n.prevBtn.addEventListener("click",t.prev);t.next=rt;n.nextBtn.addEventListener("click",t.next);t.playMode=ri;n.playModeBtn.addEventListener("click",t.playMode);n.playModeBtn.addEventListener("mouseenter",function(){this.style.background="rgba(212, 175, 55, 0.15)";this.style.color="var(--primary)";this.style.border="1px solid rgba(212, 175, 55, 0.4)";this.style.boxShadow="0 0 15px rgba(212, 175, 55, 0.3)";this.style.borderRadius="var(--radius-md)";this.style.transform="translateY(-2px)"});n.playModeBtn.addEventListener("mouseleave",function(){this.style.background="rgba(255, 255, 255, 0.05)";this.style.color="var(--text-secondary)";this.style.border="1px solid rgba(212, 175, 55, 0.2)";this.style.boxShadow="none";this.style.borderRadius="var(--radius-md)";this.style.transform="none"});t.cloud=ui;n.cloudBtn.addEventListener("click",t.cloud);t.timeupdate=gt;n.audioPlayer.addEventListener("timeupdate",t.timeupdate);t.ended=()=>{f===2?(n.audioPlayer.currentTime=0,e()):rt()};n.audioPlayer.addEventListener("ended",t.ended);t.progressClick=ii;n.progressBar.addEventListener("click",t.progressClick);t.songClickDesktop=it;n.songsListDesktop.addEventListener("click",t.songClickDesktop);t.songClickMobile=it;n.songsListMobile.addEventListener("click",t.songClickMobile)}function k(){c==="cover"?(n.coverPage.classList.remove("active"),n.lyricsPage.classList.add("active"),c="lyrics"):(n.lyricsPage.classList.remove("active"),n.coverPage.classList.add("active"),c="cover")}function oi(){if(n.albumCover&&n.coverPage&&n.lyricsPage){n.albumCover.addEventListener("click",function(){k()});const t=document.getElementById("lyrics-indicator"),i=document.getElementById("lyrics-indicator-2");t&&t.addEventListener("click",function(){c==="cover"&&k()});i&&i.addEventListener("click",function(){c==="cover"&&k()});n.lyricsPage.addEventListener("click",function(n){if(c==="lyrics"){const t=document.getElementById("progress-bar"),i=document.querySelector(".progress-container");if(n.target===t||n.target===i||t.contains(n.target)||i.contains(n.target))return;k()}});n.coverPage.classList.add("active");n.lyricsPage.classList.remove("active");c="cover"}}function d(n){const i=n.split("\n"),t=[];for(let n=0;n<i.length;n++){const u=i[n].trim();if(u){const r=u.match(/\[(\d{1,2}):(\d{1,2})(?:\.(\d{2,3}))?\](.*)/);if(r){const i=parseInt(r[1]),u=parseInt(r[2]);let n=0;r[3]&&(n=r[3].length===2?parseInt(r[3])*10:parseInt(r[3]));const f=r[4].trim(),e=i*60+u+n/1e3;t.push({time:e,text:f||"♪"})}}}return t.sort((n,t)=>n.time-t.time),t}async function si(t,r){i=[];v=-1;n.lyricsContent&&(n.lyricsContent.innerHTML='<div class="lyrics-empty">加载歌词中...<\/div>');try{const u=neteasePlaylists&&neteasePlaylists.some(n=>n.id===r);u?await hi(t):await ci(t,r);i.length===0&&n.lyricsContent&&(n.lyricsContent.innerHTML='<div class="lyrics-empty">暂无歌词<\/div>')}catch(u){console.error("加载歌词失败:",u);n.lyricsContent&&(n.lyricsContent.innerHTML='<div class="lyrics-empty">歌词加载失败<\/div>')}}async function hi(t){try{const n=r[u];if(!n)throw new Error("无法获取当前歌曲信息");if(console.log("当前歌曲信息:",n),n.lrc){console.log("使用歌曲对象中的歌词URL:",n.lrc);const r=await fetch(n.lrc),t=await r.text();if(t&&t.trim()!==""&&!t.includes("error")&&!t.includes("暂无歌词")){i=d(t);console.log(`成功加载歌词，歌词行数: ${i.length}`);a();return}}let f=n.neteaseId;if(!f){console.log("未找到保存的歌曲ID，通过搜索API获取");const i=`https://music.zhheo.com/meting-api/?server=netease&type=search&id=${encodeURIComponent(t)}`,r=await fetch(i),n=await r.json();if(!n||n.length===0)throw new Error("未找到歌曲信息");if(f=n[0].id,!f)throw new Error("无法获取歌曲ID");}console.log(`获取歌词，歌曲ID: ${f}`);const o=`https://music.zhheo.com/meting-api/?server=netease&type=lrc&id=${f}`,s=await fetch(o),e=await s.text();if(!e||e.trim()===""||e.includes("error")||e.includes("暂无歌词")){console.log("主API无歌词，尝试备用API");const t=`https://api.injahow.cn/meting/?type=lrc&id=${f}`,r=await fetch(t),n=await r.text();if(!n||n.trim()===""||n.includes("error")||n.includes("暂无歌词"))throw new Error("该歌曲暂无歌词");i=d(n)}else i=d(e);console.log(`成功加载歌词，歌词行数: ${i.length}`);a()}catch(f){console.error("加载网易云歌词失败:",f);n.lyricsContent&&(n.lyricsContent.innerHTML=`<div class="lyrics-empty">歌词加载失败: ${f.message}</div>`);throw f;}}async function ci(n,t){try{console.log(`尝试加载歌词: 歌曲名=${n}, 专辑ID=${t}`);let u="";if(t==="dy"?u="2024 In Tokyo live":t==="yq"?u="1701":t==="gs"?u="勾三搭四":t==="io"?u="IO":t==="kj"?u="看见":t==="bjb"?u="北京不插电":t==="fg"?u="梵高先生":t==="bjj"?u="被禁忌的游戏":t==="gt"?u="工体东路没有人":t==="im"?u="IMAGINE":t==="nh"?u="你好，郑州":t==="dj"?u="动静":t==="gj"?u="108个关键词":t==="zg"?u="这个世界会好吗":t==="zy"?u="在每一条伤心的应天大街上":t==="wa"?u="我爱南京":t==="ej"?u="二零零九年十月十六日事件":t==="dyy"?u="电声与管弦乐":t==="dye"?u="电声与管弦乐II":t==="js"?u="爵士乐与不插电":t==="8"?u="8":t==="f"?u="F":t==="洗心革面"?u="洗心革面":t==="xx"&&(u="洗心革面"),!u)throw new Error(`未知专辑: ${t}`);let f=`lrc/${u}/${n}.lrc`;console.log(`歌词文件路径: ${f}`);let r;try{if(r=await fetch(f),!r.ok){const n=window.location.origin+"/"+f;console.log(`尝试绝对路径: ${n}`);r=await fetch(n)}if(!r.ok){const t=window.location.pathname.split("/").slice(0,-1).join("/"),n=t+"/"+f;console.log(`尝试基于页面路径: ${n}`);r=await fetch(n)}if(!r.ok){const n=f+"?t="+Date.now();console.log(`尝试带缓存破坏参数: ${n}`);r=await fetch(n)}}catch(o){console.warn(`歌词文件加载失败: ${o.message}`);r={ok:!1,status:404}}if(!r.ok){if(u==="勾三搭四"){const t=["你的早晨&天空之城&暧昧","杭州&我们不能失去信仰"];for(const i of t)if(i.includes(n)){f=`lrc/${u}/${i}.lrc`;console.log(`尝试特殊歌词文件路径: ${f}`);try{if(r=await fetch(f),!r.ok){const n=window.location.origin+"/"+f;r=await fetch(n)}if(!r.ok){const n=window.location.pathname.split("/").slice(0,-1).join("/"),t=n+"/"+f;r=await fetch(t)}if(!r.ok){const n=f+"?t="+Date.now();r=await fetch(n)}if(r.ok)break}catch(e){console.warn(`特殊歌词文件加载失败: ${e.message}`)}}}if(!r.ok){let t=n.replace(/（/g,"(").replace(/）/g,")");if(t!==n){f=`lrc/${u}/${t}.lrc`;console.log(`尝试修改后的歌词文件路径: ${f}`);try{if(r=await fetch(f),!r.ok){const n=window.location.origin+"/"+f;r=await fetch(n)}if(!r.ok){const n=window.location.pathname.split("/").slice(0,-1).join("/"),t=n+"/"+f;r=await fetch(t)}if(!r.ok){const n=f+"?t="+Date.now();r=await fetch(n)}}catch(i){console.warn(`修改后的歌词文件加载失败: ${i.message}`)}}}if(!r.ok){const t=encodeURIComponent(n),i=encodeURIComponent(u);f=`lrc/${i}/${t}.lrc`;console.log(`尝试URL编码后的歌词文件路径: ${f}`);try{if(r=await fetch(f),!r.ok){const n=window.location.origin+"/"+f;r=await fetch(n)}if(!r.ok){const n=window.location.pathname.split("/").slice(0,-1).join("/"),t=n+"/"+f;r=await fetch(t)}if(!r.ok){const n=f+"?t="+Date.now();r=await fetch(n)}}catch(e){console.warn(`URL编码后的歌词文件加载失败: ${e.message}`)}}}if(!r.ok){console.warn(`歌词文件不存在: ${f}, 状态码: ${r.status}`);i=[];a();return}const e=await r.text();if(console.log(`歌词文件内容长度: ${e.length}`),!e||e.trim()===""){console.warn(`歌词文件为空: ${f}`);i=[];a();return}i=d(e);console.log(`解析后的歌词数量: ${i.length}`);console.log(`解析后的歌词内容:`,i);a()}catch(r){console.error("加载本地歌词失败:",r);i=[];a()}}function ft(){const n=document.getElementById("lyrics-indicator"),t=document.getElementById("lyrics-indicator-2"),r=i.length>0&&!(i.length===1&&i[0].text==="♪")&&!(i.length===1&&i[0].text==="纯音乐")&&!(i.length===1&&i[0].text==="无歌词");n&&(r?(n.classList.add("active"),n.title="有歌词"):(n.classList.remove("active"),n.title="无歌词"));t&&(r?(t.classList.add("active"),t.title="有歌词"):(t.classList.remove("active"),t.title="无歌词"))}function a(){if(n.lyricsContent){if(n.lyricsContent.classList.remove("single-line"),ft(),i.length===0){n.lyricsContent.innerHTML='<div class="lyrics-empty">暂无歌词<\/div>';return}const r=i.length===1||i.length===2&&i[1].text==="♪"||i.length===2&&i[1].text==="纯音乐"||i.length===2&&i[1].text==="无歌词";r&&n.lyricsContent.classList.add("single-line");let t="";for(let n=0;n<i.length;n++)t+=`<div class="lyrics-line" data-index="${n}" data-time="${i[n].time}">${i[n].text}</div>`;n.lyricsContent.innerHTML=t;v=-1;o&&et()}}function et(){if(n.audioPlayer&&i.length!==0){const r=n.audioPlayer.currentTime;let t=-1;for(let n=i.length-1;n>=0;n--)if(r>=i[n].time){t=n;break}if(t!==v){const r=n.lyricsContent.querySelectorAll(".lyrics-line");if(r.forEach(n=>{n.classList.remove("active","past","next","past-1","past-2","past-3","next-1","next-2","next-3")}),t>=0){const r=n.lyricsContent.querySelector(`.lyrics-line[data-index="${t}"]`);if(r){r.classList.add("active");for(let i=1;i<=3;i++){const r=t-i;if(r>=0){const t=n.lyricsContent.querySelector(`.lyrics-line[data-index="${r}"]`);t&&t.classList.add(`past-${i}`)}}for(let r=1;r<=3;r++){const u=t+r;if(u<i.length){const t=n.lyricsContent.querySelector(`.lyrics-line[data-index="${u}"]`);t&&t.classList.add(`next-${r}`)}}const u=n.lyricsContent,f=u.clientHeight,e=r.clientHeight,o=r.offsetTop,s=o-f/2+e/2;u.scrollTop=s}}v=t}}}function ot(){}const n={audioPlayer:document.getElementById("audio-player"),playPauseBtn:document.getElementById("play-pause-btn"),playIcon:document.getElementById("play-icon"),pauseIcon:document.getElementById("pause-icon"),prevBtn:document.getElementById("prev-btn"),nextBtn:document.getElementById("next-btn"),playModeBtn:document.getElementById("play-mode-btn"),modeIcon:document.getElementById("mode-icon"),progressBar:document.getElementById("progress-bar"),progress:document.getElementById("progress"),currentTimeElement:document.getElementById("current-time"),totalTimeElement:document.getElementById("total-time"),songTitleElement:document.getElementById("song-title"),songArtistElement:document.getElementById("song-artist"),lyricsSongTitleElement:document.getElementById("lyrics-song-title"),lyricsSongArtistElement:document.getElementById("lyrics-song-artist"),coverImage:document.getElementById("cover-image"),albumCover:document.getElementById("album-cover"),songsListDesktop:document.getElementById("songs-list-desktop"),songsListMobile:document.getElementById("songs-list-mobile"),albumsList:document.getElementById("albums-list"),cloudBtn:document.getElementById("cloud-btn"),coverPage:document.getElementById("cover-page"),lyricsPage:document.getElementById("lyrics-page"),mobileSongsCollapse:document.getElementById("mobile-songs-collapse"),mobileSongsContainer:document.getElementById("mobile-songs-container"),commentsToggleBtn:document.getElementById("comments-toggle-btn"),walineContainer:document.getElementById("waline"),backToTopBtn:document.getElementById("back-to-top"),lyricsContainer:document.querySelector(".lyrics-container"),lyricsContent:document.querySelector(".lyrics-content")};let u=0,o=!1,f=0,h=null,r=window.localMusicList||[],i=[],v=-1,c="cover",y=null,p=null;n.audioPlayer.volume=80/100;const t={playPause:null,prev:null,next:null,playMode:null,cloud:null,timeupdate:null,progressClick:null,ended:null,albumCover:null,songClickDesktop:null,songClickMobile:null,lyricsToggle:null};if(ei(),window.addEventListener("beforeunload",fi),lt(),st(),n.commentsToggleBtn&&n.walineContainer){n.walineContainer.classList.add("show");const t=n.commentsToggleBtn.childNodes[2];t.textContent=" 收起留言板 ";n.commentsToggleBtn.classList.add("active");n.commentsToggleBtn.addEventListener("click",function(){const i=!n.walineContainer.classList.contains("show"),t=n.commentsToggleBtn.childNodes[2];i?(n.walineContainer.classList.add("show"),t.textContent=" 收起留言板 ",n.commentsToggleBtn.classList.add("active"),window.walineInitialized||(window.walineInitialized=!0)):(n.walineContainer.classList.remove("show"),t.textContent=" 展开留言板 ",n.commentsToggleBtn.classList.remove("active"))})}n.backToTopBtn&&(window.addEventListener("scroll",function(){window.scrollY>300?n.backToTopBtn.classList.add("visible"):n.backToTopBtn.classList.remove("visible")}),n.backToTopBtn.addEventListener("click",function(){window.scrollTo({top:0,behavior:"smooth"})}),n.backToTopBtn.addEventListener("keydown",function(n){(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),window.scrollTo({top:0,behavior:"smooth"}))}));neteasePlaylists&&neteasePlaylists.length>0?w(neteasePlaylists[0].id):musicAlbums&&musicAlbums.length>0?w(musicAlbums[0].id):yt();f=0;n.modeIcon.innerHTML='<path d="M8 20V21.9324C8 22.2086 7.77614 22.4324 7.5 22.4324C7.38303 22.4324 7.26977 22.3914 7.17991 22.3165L3.06093 18.8841C2.84879 18.7073 2.82013 18.392 2.99691 18.1799C3.09191 18.0659 3.23264 18 3.38103 18L18 18C19.1046 18 20 17.1045 20 16V7.99997H22V16C22 18.2091 20.2091 20 18 20H8ZM16 3.99997V2.0675C16 1.79136 16.2239 1.5675 16.5 1.5675C16.617 1.5675 16.7302 1.60851 16.8201 1.68339L20.9391 5.11587C21.1512 5.29266 21.1799 5.60794 21.0031 5.82008C20.9081 5.93407 20.7674 5.99998 20.619 5.99998L6 5.99997C4.89543 5.99997 4 6.8954 4 7.99997V16H2V7.99997C2 5.79083 3.79086 3.99997 6 3.99997H16Z"/>';n.playModeBtn.style.backgroundColor="transparent";n.playModeBtn.style.color="var(--text-secondary)";r.length>0&&l(r[0]);ot();oi();ot()})
