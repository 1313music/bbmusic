document.addEventListener('DOMContentLoaded',function(){const elements={audioPlayer:document.getElementById('audio-player'),playPauseBtn:document.getElementById('play-pause-btn'),playIcon:document.getElementById('play-icon'),pauseIcon:document.getElementById('pause-icon'),prevBtn:document.getElementById('prev-btn'),nextBtn:document.getElementById('next-btn'),playModeBtn:document.getElementById('play-mode-btn'),modeIcon:document.getElementById('mode-icon'),progressBar:document.getElementById('progress-bar'),progress:document.getElementById('progress'),currentTimeElement:document.getElementById('current-time'),totalTimeElement:document.getElementById('total-time'),songTitleElement:document.getElementById('song-title'),songArtistElement:document.getElementById('song-artist'),coverImage:document.getElementById('cover-image'),albumCover:document.getElementById('album-cover'),songsListDesktop:document.getElementById('songs-list-desktop'),songsListMobile:document.getElementById('songs-list-mobile'),albumsList:document.getElementById('albums-list'),cloudBtn:document.getElementById('cloud-btn'),mobileSongsCollapse:document.getElementById('mobile-songs-collapse'),mobileSongsContainer:document.getElementById('mobile-songs-container'),commentsToggleBtn:document.getElementById('comments-toggle-btn'),walineContainer:document.getElementById('waline'),backToTopBtn:document.getElementById('back-to-top')};let currentSongIndex=0;let isPlaying=false;let playMode=0;let currentAlbumId=null;let filteredSongs=window.localMusicList||[];let currentLoadedMetadataHandler=null;let currentErrorHandler=null;const defaultVolume=80;elements.audioPlayer.volume=defaultVolume/100;function initMobileSongsToggle(){if(!elements.mobileSongsCollapse||!elements.mobileSongsContainer)return;let isCollapsed=false;let isAnimating=false;let animationTimeout=null;function debounce(func,wait){return function(){const context=this;const args=arguments;clearTimeout(animationTimeout);animationTimeout=setTimeout(()=>{func.apply(context,args)},wait)}}function toggleCollapse(){if(isAnimating)return;isCollapsed=!isCollapsed;isAnimating=true;requestAnimationFrame(()=>{if(isCollapsed){elements.mobileSongsContainer.classList.add('collapsed')}else{elements.mobileSongsContainer.classList.remove('collapsed')}setTimeout(()=>{isAnimating=false},320)})}const debouncedToggleCollapse=debounce(toggleCollapse,30);elements.mobileSongsCollapse.addEventListener('click',function(){debouncedToggleCollapse()});elements.mobileSongsContainer.querySelector('.songs-header').addEventListener('click',function(e){if(e.target.closest('.collapse-btn'))return;debouncedToggleCollapse()})}function initLazyLoading(){if('IntersectionObserver'in window){window.imageObserver=new IntersectionObserver((entries,observer)=>{entries.forEach(entry=>{if(entry.isIntersecting){const img=entry.target;const src=img.getAttribute('data-src');if(src){img.src=src;img.removeAttribute('data-src');img.onload=()=>{img.style.opacity='0';img.style.transition='opacity 0.3s';img.classList.add('lazy-loaded');requestAnimationFrame(()=>{img.style.opacity='1'})};observer.unobserve(img)}}})},{rootMargin:'50px 0px',threshold:0.01});document.querySelectorAll('img[data-src]').forEach(img=>{window.imageObserver.observe(img)})}else{lazyLoadFallback()}}function lazyLoadFallback(){const lazyImages=document.querySelectorAll('img[data-src]');loadVisibleImages();let scrollTimeout;window.addEventListener('scroll',()=>{if(scrollTimeout){clearTimeout(scrollTimeout)}scrollTimeout=setTimeout(()=>{loadVisibleImages()},200)});let resizeTimeout;window.addEventListener('resize',()=>{if(resizeTimeout){clearTimeout(resizeTimeout)}resizeTimeout=setTimeout(()=>{loadVisibleImages()},200)});function loadVisibleImages(){lazyImages.forEach(img=>{if(img.getAttribute('data-src')){const rect=img.getBoundingClientRect();const isVisible=(rect.top<=window.innerHeight&&rect.bottom>=0&&rect.left<=window.innerWidth&&rect.right>=0);if(isVisible){const src=img.getAttribute('data-src');img.src=src;img.removeAttribute('data-src');img.onload=()=>{img.style.opacity='0';img.style.transition='opacity 0.3s';img.classList.add('lazy-loaded');requestAnimationFrame(()=>{img.style.opacity='1'})}}}});const remainingImages=document.querySelectorAll('img[data-src]');if(remainingImages.length===0){window.removeEventListener('scroll',loadVisibleImages);window.removeEventListener('resize',loadVisibleImages)}}}function initAlbums(){if(musicAlbums&&musicAlbums.length>0){elements.albumsList.innerHTML='';if(neteasePlaylists&&neteasePlaylists.length>0){neteasePlaylists.forEach(playlist=>{const albumItem=document.createElement('div');albumItem.className='album-item';albumItem.dataset.id=playlist.id;albumItem.innerHTML=`<div class="album-image"><img data-src="${playlist.cover}"alt="${playlist.name}"loading="lazy"></div><div class="album-info"><h3 class="album-title">${playlist.name}</h3></div>`;albumItem.addEventListener('click',()=>{filterSongsByAlbum(playlist.id)});elements.albumsList.appendChild(albumItem)})}musicAlbums.forEach(album=>{const albumItem=document.createElement('div');albumItem.className='album-item';albumItem.dataset.id=album.id;albumItem.innerHTML=`<div class="album-image"><img data-src="${album.cover}"alt="${album.name}"loading="lazy"></div><div class="album-info"><h3 class="album-title">${album.name}</h3></div>`;albumItem.addEventListener('click',()=>{filterSongsByAlbum(album.id)});elements.albumsList.appendChild(albumItem)});initLazyLoading();triggerAlbumsAnimation()}}function triggerAlbumsAnimation(){const albumItems=elements.albumsList.querySelectorAll('.album-item');albumItems.forEach((album,index)=>{album.style.animation='none';album.style.opacity='0';void album.offsetWidth;album.style.animation=`bounceIn 0.6s ease-out ${index*0.1}s both`})}function filterSongsByAlbum(albumId){if(albumId===currentAlbumId){currentAlbumId=null;filteredSongs=[];musicAlbums.forEach(album=>{if(album.songs&&Array.isArray(album.songs)){filteredSongs.push(...album.songs)}});resetSongsListAnimation();renderSongsListWithAnimation();if(filteredSongs.length>0){const currentSong=elements.audioPlayer.src;const songExists=filteredSongs.some(song=>song.src===currentSong);if(!songExists){currentSongIndex=0;loadSong(filteredSongs[currentSongIndex]);if(isPlaying){elements.audioPlayer.addEventListener('loadedmetadata',function onLoaded(){playSong();elements.audioPlayer.removeEventListener('loadedmetadata',onLoaded)})}}}}else if(albumId.startsWith('netease_playlist_')){currentAlbumId=albumId;const playlistConfig=neteasePlaylists.find(playlist=>playlist.id===albumId);if(!playlistConfig){elements.songsListDesktop.innerHTML='<div class="song-item"><div class="song-details"><div class="song-name">未找到网易云歌单配置</div></div></div>';elements.songsListMobile.innerHTML='<div class="song-item"><div class="song-details"><div class="song-name">未找到网易云歌单配置</div></div></div>';return}elements.songsListDesktop.innerHTML='<div class="song-item"><div class="song-details"><div class="song-name">正在加载网易云歌单...</div></div></div>';elements.songsListMobile.innerHTML='<div class="song-item"><div class="song-details"><div class="song-name">正在加载网易云歌单...</div></div></div>';fetch('https://music.zhheo.com/meting-api/?server=netease&type=playlist&id='+playlistConfig.playlistId+'&r='+Math.random()).then(response=>response.json()).then(data=>{if(data&&data.length>0){filteredSongs=data.map((song,index)=>({name:song.name||'未知歌曲',artist:song.artist||'未知艺术家',src:song.url||'',cover:song.pic||'img/default.jpg',id:`netease_${playlistConfig.id}_${index}`}));resetSongsListAnimation();renderSongsListWithAnimation();if(filteredSongs.length>0){const currentSong=elements.audioPlayer.src;const songExists=filteredSongs.some(song=>song.src===currentSong);if(!songExists){currentSongIndex=0;loadSong(filteredSongs[currentSongIndex]);if(isPlaying){elements.audioPlayer.addEventListener('loadedmetadata',function onLoaded(){playSong();elements.audioPlayer.removeEventListener('loadedmetadata',onLoaded)})}}}}else{elements.songsListDesktop.innerHTML='<div class="song-item"><div class="song-details"><div class="song-name">加载网易云歌单失败</div></div></div>';elements.songsListMobile.innerHTML='<div class="song-item"><div class="song-details"><div class="song-name">加载网易云歌单失败</div></div></div>'}}).catch(error=>{console.error('加载网易云歌单失败:',error);elements.songsListDesktop.innerHTML='<div class="song-item"><div class="song-details"><div class="song-name">加载网易云歌单失败</div></div></div>';elements.songsListMobile.innerHTML='<div class="song-item"><div class="song-details"><div class="song-name">加载网易云歌单失败</div></div></div>'})}else{currentAlbumId=albumId;if(musicAlbums){const album=musicAlbums.find(album=>album.id===albumId);if(album){filteredSongs=[...album.songs]}}resetSongsListAnimation();renderSongsListWithAnimation();if(filteredSongs.length>0){const currentSong=elements.audioPlayer.src;const songExists=filteredSongs.some(song=>song.src===currentSong);if(!songExists){currentSongIndex=0;loadSong(filteredSongs[currentSongIndex]);if(isPlaying){elements.audioPlayer.addEventListener('loadedmetadata',function onLoaded(){playSong();elements.audioPlayer.removeEventListener('loadedmetadata',onLoaded)})}}}}}function resetSongsListAnimation(){const songsListDesktop=elements.songsListDesktop;const songsListMobile=elements.songsListMobile;songsListDesktop.style.animation='none';songsListMobile.style.animation='none';void songsListDesktop.offsetWidth;void songsListMobile.offsetWidth;songsListDesktop.style.animation='slideInUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)';songsListMobile.style.animation='slideInUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)'}function renderSongsListWithAnimation(){elements.songsListDesktop.innerHTML='';elements.songsListMobile.innerHTML='';if(filteredSongs.length===0){const emptyMessage=document.createElement('div');emptyMessage.className='song-item';emptyMessage.innerHTML=`<div class="song-details"><div class="song-name">暂无歌曲</div></div>`;elements.songsListDesktop.appendChild(emptyMessage);elements.songsListMobile.appendChild(emptyMessage.cloneNode(true));return}const desktopFragment=document.createDocumentFragment();const mobileFragment=document.createDocumentFragment();filteredSongs.forEach((song,index)=>{const isCurrentSong=elements.audioPlayer.src.includes(song.src);if(isCurrentSong){currentSongIndex=index}const songHTML=`<div class="song-number">${index+1}</div><div class="song-details"><div class="song-name">${song.name}</div><div class="song-artist-name">${song.artist||song.id}</div></div>`;const desktopItem=document.createElement('div');desktopItem.className='song-item';desktopItem.dataset.index=index;if(isCurrentSong){desktopItem.classList.add('active')}desktopItem.innerHTML=songHTML;desktopFragment.appendChild(desktopItem);const mobileItem=desktopItem.cloneNode(true);mobileFragment.appendChild(mobileItem)});elements.songsListDesktop.appendChild(desktopFragment);elements.songsListMobile.appendChild(mobileFragment);triggerSongsListAnimation()}function triggerSongsListAnimation(){const desktopSongs=elements.songsListDesktop.querySelectorAll('.song-item');const mobileSongs=elements.songsListMobile.querySelectorAll('.song-item');[...desktopSongs,...mobileSongs].forEach((song,index)=>{song.style.animation='none';song.style.opacity='0';void song.offsetWidth;song.style.animation=`fadeInRight 0.5s ease-out ${index*0.05}s both`})}function renderSongsList(){elements.songsListDesktop.innerHTML='';elements.songsListMobile.innerHTML='';if(filteredSongs.length===0){const emptyMessage=document.createElement('div');emptyMessage.className='song-item';emptyMessage.innerHTML=`<div class="song-details"><div class="song-name">暂无歌曲</div></div>`;elements.songsListDesktop.appendChild(emptyMessage);elements.songsListMobile.appendChild(emptyMessage.cloneNode(true));return}const desktopFragment=document.createDocumentFragment();const mobileFragment=document.createDocumentFragment();filteredSongs.forEach((song,index)=>{const isCurrentSong=elements.audioPlayer.src.includes(song.src);if(isCurrentSong){currentSongIndex=index}const songHTML=`<div class="song-number">${index+1}</div><div class="song-details"><div class="song-name">${song.name}</div><div class="song-artist-name">${song.artist||song.id}</div></div>`;const desktopItem=document.createElement('div');desktopItem.className='song-item';desktopItem.dataset.index=index;if(isCurrentSong){desktopItem.classList.add('active')}desktopItem.innerHTML=songHTML;desktopFragment.appendChild(desktopItem);const mobileItem=desktopItem.cloneNode(true);mobileFragment.appendChild(mobileItem)});elements.songsListDesktop.appendChild(desktopFragment);elements.songsListMobile.appendChild(mobileFragment)}function handleSongClick(event){const songItem=event.target.closest('.song-item');if(!songItem)return;const index=parseInt(songItem.dataset.index);if(isNaN(index)||index<0||index>=filteredSongs.length)return;currentSongIndex=index;showLoadingState();loadSong(filteredSongs[currentSongIndex]);elements.audioPlayer.addEventListener('loadedmetadata',function onLoaded(){hideLoadingState();playSong();elements.audioPlayer.removeEventListener('loadedmetadata',onLoaded)});elements.audioPlayer.addEventListener('error',function onError(){hideLoadingState();showErrorMessage('音频加载失败，请检查网络连接');elements.audioPlayer.removeEventListener('error',onError)})}function showLoadingState(){elements.playPauseBtn.classList.add('loading');elements.playIcon.style.display='none';elements.pauseIcon.style.display='none';if(!elements.playPauseBtn.querySelector('.loading-indicator')){const loader=document.createElement('div');loader.className='loading-indicator';loader.innerHTML='<i class="fa fa-spinner fa-spin"></i>';elements.playPauseBtn.appendChild(loader)}}function hideLoadingState(){elements.playPauseBtn.classList.remove('loading');const loader=elements.playPauseBtn.querySelector('.loading-indicator');if(loader){loader.remove()}if(isPlaying){elements.playIcon.style.display='none';elements.pauseIcon.style.display='block'}else{elements.playIcon.style.display='block';elements.pauseIcon.style.display='none'}}function showErrorMessage(message){const errorToast=document.createElement('div');errorToast.className='error-toast';errorToast.innerHTML=`<i class="fa fa-exclamation-circle"></i><span>${message}</span>`;document.body.appendChild(errorToast);setTimeout(()=>{errorToast.classList.add('fade-out');setTimeout(()=>{if(errorToast.parentNode){errorToast.parentNode.removeChild(errorToast)}},300)},3000)}function loadSong(song){if(!song)return;showLoadingState();elements.songTitleElement.textContent=song.name;elements.songArtistElement.textContent=song.artist||song.id;let songCover='img/1.jpg';if(song.cover){songCover=song.cover}else if(currentAlbumId&&musicAlbums){const album=musicAlbums.find(album=>album.id===currentAlbumId);if(album&&album.cover){songCover=album.cover}else{for(const album of musicAlbums){if(album.songs&&album.songs.some(s=>s.src===song.src)){if(album.cover){songCover=album.cover;break}}}}}if(songCover!=='img/default.jpg'){elements.coverImage.removeAttribute('src');elements.coverImage.setAttribute('data-src',songCover);if(isElementInViewport(elements.coverImage)){elements.coverImage.src=songCover;elements.coverImage.removeAttribute('data-src');elements.coverImage.onload=()=>{elements.coverImage.style.opacity='0';elements.coverImage.style.transition='opacity 0.3s';elements.coverImage.classList.add('lazy-loaded');requestAnimationFrame(()=>{elements.coverImage.style.opacity='1'})}}else{if(window.imageObserver){window.imageObserver.observe(elements.coverImage)}else{elements.coverImage.src=songCover;elements.coverImage.removeAttribute('data-src');elements.coverImage.onload=()=>{elements.coverImage.style.opacity='0';elements.coverImage.style.transition='opacity 0.3s';elements.coverImage.classList.add('lazy-loaded');requestAnimationFrame(()=>{elements.coverImage.style.opacity='1'})}}}}else{elements.coverImage.src=songCover}elements.audioPlayer.src=song.src;updateActiveSongInList();if(currentErrorHandler){elements.audioPlayer.removeEventListener('error',currentErrorHandler)}if(currentLoadedMetadataHandler){elements.audioPlayer.removeEventListener('loadedmetadata',currentLoadedMetadataHandler)}currentErrorHandler=handleAudioError;elements.audioPlayer.addEventListener('error',currentErrorHandler);currentLoadedMetadataHandler=function(){hideLoadingState();updateTotalTime()};elements.audioPlayer.addEventListener('loadedmetadata',currentLoadedMetadataHandler)}function isElementInViewport(el){const rect=el.getBoundingClientRect();return(rect.top>=0&&rect.left>=0&&rect.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&rect.right<=(window.innerWidth||document.documentElement.clientWidth))}function handleAudioError(event){hideLoadingState();const error=event.target.error;let errorMessage='音频加载失败';switch(error.code){case error.MEDIA_ERR_ABORTED:errorMessage='音频加载被中止';break;case error.MEDIA_ERR_NETWORK:errorMessage='网络错误，音频加载失败';break;case error.MEDIA_ERR_DECODE:errorMessage='音频解码失败';break;case error.MEDIA_ERR_SRC_NOT_SUPPORTED:errorMessage='音频格式不支持';break;default:errorMessage='音频加载失败，请检查网络连接';break}showErrorMessage(errorMessage);console.error('音频加载错误:',error)}function updateActiveSongInList(){const activeItems=document.querySelectorAll('.song-item.active');activeItems.forEach(item=>item.classList.remove('active'));const currentItems=document.querySelectorAll(`.song-item[data-index="${currentSongIndex}"]`);currentItems.forEach(item=>item.classList.add('active'))}function playSong(){if(filteredSongs.length===0)return;showLoadingState();const playPromise=elements.audioPlayer.play();if(playPromise!==undefined){playPromise.then(()=>{hideLoadingState();isPlaying=true;elements.playIcon.style.display='none';elements.pauseIcon.style.display='block';elements.albumCover.classList.add('playing')}).catch(error=>{hideLoadingState();console.error('播放失败:',error);let errorMessage='播放失败';if(error.name==='NotAllowedError'){errorMessage='浏览器阻止了自动播放，请点击播放按钮'}else if(error.name==='NotSupportedError'){errorMessage='音频格式不支持'}else{errorMessage='播放失败，请重试'}showErrorMessage(errorMessage)})}else{try{elements.audioPlayer.play();isPlaying=true;elements.playIcon.style.display='none';elements.pauseIcon.style.display='block';elements.albumCover.classList.add('playing');hideLoadingState()}catch(error){hideLoadingState();console.error('播放失败:',error);showErrorMessage('播放失败，请重试')}}}function pauseSong(){elements.audioPlayer.pause();isPlaying=false;elements.playIcon.style.display='block';elements.pauseIcon.style.display='none';elements.albumCover.classList.remove('playing')}function nextSong(){if(filteredSongs.length===0)return;if(playMode===1){const randomIndex=Math.floor(Math.random()*filteredSongs.length);currentSongIndex=randomIndex}else if(playMode===2){}else{currentSongIndex=(currentSongIndex+1)%filteredSongs.length}if(playMode!==2){loadSong(filteredSongs[currentSongIndex]);elements.audioPlayer.addEventListener('loadedmetadata',function onLoaded(){playSong();elements.audioPlayer.removeEventListener('loadedmetadata',onLoaded)})}else{playSong()}}function prevSong(){if(filteredSongs.length===0)return;if(playMode===1){const randomIndex=Math.floor(Math.random()*filteredSongs.length);currentSongIndex=randomIndex}else if(playMode===2){}else{currentSongIndex=(currentSongIndex-1+filteredSongs.length)%filteredSongs.length}if(playMode!==2){loadSong(filteredSongs[currentSongIndex]);elements.audioPlayer.addEventListener('loadedmetadata',function onLoaded(){playSong();elements.audioPlayer.removeEventListener('loadedmetadata',onLoaded)})}else{playSong()}}function updateProgress(){const{duration,currentTime}=elements.audioPlayer;if(duration&&!isNaN(duration)){const progressPercent=(currentTime/duration)*100;elements.progress.style.width=`${progressPercent}%`}updateCurrentTime()}function updateCurrentTime(){const currentTime=elements.audioPlayer.currentTime;elements.currentTimeElement.textContent=formatTime(currentTime)}function updateTotalTime(){const duration=elements.audioPlayer.duration;if(duration&&!isNaN(duration)){elements.totalTimeElement.textContent=formatTime(duration)}}function formatTime(seconds){const minutes=Math.floor(seconds/60);const remainingSeconds=Math.floor(seconds%60);return`${minutes.toString().padStart(2,'0')}:${remainingSeconds.toString().padStart(2,'0')}`}function setProgress(e){const width=elements.progressBar.clientWidth;const rect=elements.progressBar.getBoundingClientRect();const clickX=e.clientX-rect.left;const duration=elements.audioPlayer.duration;if(duration){const seekTime=(clickX/width)*duration;elements.audioPlayer.currentTime=seekTime}}function togglePlayMode(){playMode=(playMode+1)%4;switch(playMode){case 0:elements.modeIcon.innerHTML='<path d="M8 20V21.9324C8 22.2086 7.77614 22.4324 7.5 22.4324C7.38303 22.4324 7.26977 22.3914 7.17991 22.3165L3.06093 18.8841C2.84879 18.7073 2.82013 18.392 2.99691 18.1799C3.09191 18.0659 3.23264 18 3.38103 18L18 18C19.1046 18 20 17.1045 20 16V7.99997H22V16C22 18.2091 20.2091 20 18 20H8ZM16 3.99997V2.0675C16 1.79136 16.2239 1.5675 16.5 1.5675C16.617 1.5675 16.7302 1.60851 16.8201 1.68339L20.9391 5.11587C21.1512 5.29266 21.1799 5.60794 21.0031 5.82008C20.9081 5.93407 20.7674 5.99998 20.619 5.99998L6 5.99997C4.89543 5.99997 4 6.8954 4 7.99997V16H2V7.99997C2 5.79083 3.79086 3.99997 6 3.99997H16Z"/>';elements.playModeBtn.style.backgroundColor='transparent';elements.playModeBtn.style.color='var(--text-secondary)';break;case 1:elements.modeIcon.innerHTML='<path d="M17 3.99998V2.0675C17 1.79136 17.2239 1.5675 17.5 1.5675C17.617 1.5675 17.7302 1.60851 17.8201 1.68339L21.9391 5.11587C22.1512 5.29266 22.1799 5.60794 22.0031 5.82008C21.9081 5.93407 21.7674 5.99998 21.619 5.99998H2V3.99998H17ZM2 18H22V20H2V18ZM2 11H22V13H2V11Z"/>';elements.playModeBtn.style.backgroundColor='transparent';elements.playModeBtn.style.color='var(--text-secondary)';const existingDot=elements.playModeBtn.querySelector('.loop-dot');if(existingDot){existingDot.remove()}break;case 2:elements.modeIcon.innerHTML='<path d="M18 17.8832V16L23 19L18 22V19.9095C14.9224 19.4698 12.2513 17.4584 11.0029 14.5453L11 14.5386L10.9971 14.5453C9.57893 17.8544 6.32508 20 2.72483 20H2V18H2.72483C5.52503 18 8.05579 16.3312 9.15885 13.7574L9.91203 12L9.15885 10.2426C8.05579 7.66878 5.52503 6 2.72483 6H2V4H2.72483C6.32508 4 9.57893 6.14557 10.9971 9.45473L11 9.46141L11.0029 9.45473C12.2513 6.5416 14.9224 4.53022 18 4.09051V2L23 5L18 8V6.11684C15.7266 6.53763 13.7737 8.0667 12.8412 10.2426L12.088 12L12.8412 13.7574C13.7737 15.9333 15.7266 17.4624 18 17.8832Z"/>';elements.playModeBtn.style.backgroundColor='transparent';elements.playModeBtn.style.color='var(--text-secondary)';break;case 3:elements.modeIcon.innerHTML='<path d="M8 20V21.9325C8 22.2086 7.77614 22.4325 7.5 22.4325C7.38303 22.4325 7.26977 22.3915 7.17991 22.3166L3.06093 18.8841C2.84879 18.7073 2.82013 18.392 2.99691 18.1799C3.09191 18.0659 3.23264 18 3.38103 18L18 18C19.1046 18 20 17.1046 20 16V8H22V16C22 18.2091 20.2091 20 18 20H8ZM16 2.0675C16 1.79136 16.2239 1.5675 16.5 1.5675C16.617 1.5675 16.7302 1.60851 16.8201 1.68339L20.9391 5.11587C21.1512 5.29266 21.1799 5.60794 21.0031 5.82008C20.9081 5.93407 20.7674 5.99998 20.619 5.99998L6 6C4.89543 6 4 6.89543 4 8V16H2V8C2 5.79086 3.79086 4 6 4H16V2.0675ZM11 8H13V16H11V10H9V9L11 8Z"/>';elements.playModeBtn.style.backgroundColor='transparent';elements.playModeBtn.style.color='var(--text-secondary)';break}}function showCloudQRCode(){const qrModal=document.createElement('div');qrModal.className='qr-modal';qrModal.innerHTML=`<div class="qr-modal-content"><div class="qr-modal-header"><h3>上传歌曲至网易云盘</h3><button class="qr-modal-close">&times;</button></div><div class="qr-modal-body"><img src="img/xcx.jpg"alt="云盘二维码"class="qr-code-image"><p>扫码使用小程序上传歌曲</p><p><a href="https://mp.weixin.qq.com/s/pHsFSPTn3Cd7MXV81J4NHg"target="_blank">使用指南</a></p></div></div>`;document.body.appendChild(qrModal);const closeBtn=qrModal.querySelector('.qr-modal-close');closeBtn.addEventListener('click',function(){const modalContent=qrModal.querySelector('.qr-modal-content');modalContent.style.animation='modalBounceOut 0.4s ease-in forwards';setTimeout(()=>{document.body.removeChild(qrModal)},400)});qrModal.addEventListener('click',function(e){if(e.target===qrModal){const modalContent=qrModal.querySelector('.qr-modal-content');modalContent.style.animation='modalBounceOut 0.4s ease-in forwards';setTimeout(()=>{document.body.removeChild(qrModal)},400)}})}const eventListeners={playPause:null,prev:null,next:null,playMode:null,cloud:null,timeupdate:null,progressClick:null,ended:null,albumCover:null,songClickDesktop:null,songClickMobile:null};function cleanupEventListeners(){if(eventListeners.playPause){elements.playPauseBtn.removeEventListener('click',eventListeners.playPause)}if(eventListeners.prev){elements.prevBtn.removeEventListener('click',eventListeners.prev)}if(eventListeners.next){elements.nextBtn.removeEventListener('click',eventListeners.next)}if(eventListeners.playMode){elements.playModeBtn.removeEventListener('click',eventListeners.playMode)}if(eventListeners.cloud){elements.cloudBtn.removeEventListener('click',eventListeners.cloud)}if(eventListeners.timeupdate){elements.audioPlayer.removeEventListener('timeupdate',eventListeners.timeupdate)}if(eventListeners.progressClick){elements.progressBar.removeEventListener('click',eventListeners.progressClick)}if(eventListeners.ended){elements.audioPlayer.removeEventListener('ended',eventListeners.ended)}if(eventListeners.albumCover){elements.albumCover.removeEventListener('click',eventListeners.albumCover)}if(eventListeners.songClickDesktop){elements.songsListDesktop.removeEventListener('click',eventListeners.songClickDesktop)}if(eventListeners.songClickMobile){elements.songsListMobile.removeEventListener('click',eventListeners.songClickMobile)}}function addEventListeners(){eventListeners.playPause=()=>{if(elements.playPauseBtn.classList.contains('loading'))return;isPlaying?pauseSong():playSong()};elements.playPauseBtn.addEventListener('click',eventListeners.playPause);eventListeners.prev=prevSong;elements.prevBtn.addEventListener('click',eventListeners.prev);eventListeners.next=nextSong;elements.nextBtn.addEventListener('click',eventListeners.next);eventListeners.playMode=togglePlayMode;elements.playModeBtn.addEventListener('click',eventListeners.playMode);elements.playModeBtn.addEventListener('mouseenter',function(){this.style.background='rgba(212, 175, 55, 0.15)';this.style.color='var(--primary)';this.style.border='1px solid rgba(212, 175, 55, 0.4)';this.style.boxShadow='0 0 15px rgba(212, 175, 55, 0.3)';this.style.borderRadius='var(--radius-md)';this.style.transform='translateY(-2px)'});elements.playModeBtn.addEventListener('mouseleave',function(){this.style.background='rgba(255, 255, 255, 0.05)';this.style.color='var(--text-secondary)';this.style.border='1px solid rgba(212, 175, 55, 0.2)';this.style.boxShadow='none';this.style.borderRadius='var(--radius-md)';this.style.transform='none'});eventListeners.cloud=showCloudQRCode;elements.cloudBtn.addEventListener('click',eventListeners.cloud);eventListeners.timeupdate=updateProgress;elements.audioPlayer.addEventListener('timeupdate',eventListeners.timeupdate);eventListeners.ended=()=>{if(playMode===2){elements.audioPlayer.currentTime=0;playSong()}else{nextSong()}};elements.audioPlayer.addEventListener('ended',eventListeners.ended);eventListeners.progressClick=setProgress;elements.progressBar.addEventListener('click',eventListeners.progressClick);eventListeners.albumCover=()=>{isPlaying?pauseSong():playSong()};elements.albumCover.addEventListener('click',eventListeners.albumCover);eventListeners.songClickDesktop=handleSongClick;elements.songsListDesktop.addEventListener('click',eventListeners.songClickDesktop);eventListeners.songClickMobile=handleSongClick;elements.songsListMobile.addEventListener('click',eventListeners.songClickMobile)}addEventListeners();window.addEventListener('beforeunload',cleanupEventListeners);initAlbums();initMobileSongsToggle();if(elements.commentsToggleBtn&&elements.walineContainer){elements.walineContainer.classList.add('show');const textNode=elements.commentsToggleBtn.childNodes[2];textNode.textContent=' 收起留言板 ';elements.commentsToggleBtn.classList.add('active');elements.commentsToggleBtn.addEventListener('click',function(){const isHidden=!elements.walineContainer.classList.contains('show');const textNode=elements.commentsToggleBtn.childNodes[2];if(isHidden){elements.walineContainer.classList.add('show');textNode.textContent=' 收起留言板 ';elements.commentsToggleBtn.classList.add('active');if(!window.walineInitialized){window.walineInitialized=true}}else{elements.walineContainer.classList.remove('show');textNode.textContent=' 展开留言板 ';elements.commentsToggleBtn.classList.remove('active')}})}if(elements.backToTopBtn){window.addEventListener('scroll',function(){if(window.scrollY>300){elements.backToTopBtn.classList.add('visible')}else{elements.backToTopBtn.classList.remove('visible')}});elements.backToTopBtn.addEventListener('click',function(){window.scrollTo({top:0,behavior:'smooth'})});elements.backToTopBtn.addEventListener('keydown',function(e){if(e.key==='Enter'||e.key===' '){e.preventDefault();window.scrollTo({top:0,behavior:'smooth'})}})}if(neteasePlaylists&&neteasePlaylists.length>0){filterSongsByAlbum(neteasePlaylists[0].id)}else if(musicAlbums&&musicAlbums.length>0){filterSongsByAlbum(musicAlbums[0].id)}else{renderSongsList()}playMode=0;elements.modeIcon.innerHTML='<path d="M8 20V21.9324C8 22.2086 7.77614 22.4324 7.5 22.4324C7.38303 22.4324 7.26977 22.3914 7.17991 22.3165L3.06093 18.8841C2.84879 18.7073 2.82013 18.392 2.99691 18.1799C3.09191 18.0659 3.23264 18 3.38103 18L18 18C19.1046 18 20 17.1045 20 16V7.99997H22V16C22 18.2091 20.2091 20 18 20H8ZM16 3.99997V2.0675C16 1.79136 16.2239 1.5675 16.5 1.5675C16.617 1.5675 16.7302 1.60851 16.8201 1.68339L20.9391 5.11587C21.1512 5.29266 21.1799 5.60794 21.0031 5.82008C20.9081 5.93407 20.7674 5.99998 20.619 5.99998L6 5.99997C4.89543 5.99997 4 6.8954 4 7.99997V16H2V7.99997C2 5.79083 3.79086 3.99997 6 3.99997H16Z"/>';elements.playModeBtn.style.backgroundColor='transparent';elements.playModeBtn.style.color='var(--text-secondary)';if(filteredSongs.length>0){loadSong(filteredSongs[0])}});
