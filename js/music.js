function initMusicPlayer(){const e={audioPlayer:document.getElementById("audio-player"),playPauseBtn:document.getElementById("play-pause-btn"),playIcon:document.getElementById("play-icon"),pauseIcon:document.getElementById("pause-icon"),prevBtn:document.getElementById("prev-btn"),nextBtn:document.getElementById("next-btn"),playModeBtn:document.getElementById("play-mode-btn"),modeIcon:document.getElementById("mode-icon"),progressBar:document.getElementById("progress-bar"),progress:document.getElementById("progress"),currentTimeElement:document.getElementById("current-time"),totalTimeElement:document.getElementById("total-time"),songTitleElement:document.getElementById("song-title"),songArtistElement:document.getElementById("song-artist"),lyricsSongTitleElement:document.getElementById("lyrics-song-title"),lyricsSongArtistElement:document.getElementById("lyrics-song-artist"),coverImage:document.getElementById("cover-image"),albumCover:document.getElementById("album-cover"),songsListDesktop:document.getElementById("songs-list-desktop"),songsListMobile:document.getElementById("songs-list-mobile"),albumsList:document.getElementById("albums-list"),cloudBtn:document.getElementById("cloud-btn"),coverPage:document.getElementById("cover-page"),lyricsPage:document.getElementById("lyrics-page"),mobileSongsCollapse:document.getElementById("mobile-songs-collapse"),mobileSongsContainer:document.getElementById("mobile-songs-container"),commentsToggleBtn:document.getElementById("comments-toggle-btn"),walineContainer:document.getElementById("waline"),backToTopBtn:document.getElementById("back-to-top"),lyricsContainer:document.querySelector(".lyrics-container"),lyricsContent:document.querySelector(".lyrics-content")};let t,n,s=0,i=!1,o=0,a=null,l=window.localMusicList||[],r=[],c=-1,d=[],u=-1,m=new Map,g="cover",y=null,v=null,p=null,f=null;function L(){"IntersectionObserver"in window?(window.imageObserver=new IntersectionObserver(((e,t)=>{e.forEach((e=>{if(e.isIntersecting){const n=e.target,s=n.getAttribute("data-src");s&&(n.src=s,n.removeAttribute("data-src"),n.onload=()=>{n.style.opacity="0",n.style.transition="opacity 0.3s",n.classList.add("lazy-loaded"),requestAnimationFrame((()=>{n.style.opacity="1"}))},t.unobserve(n))}}))}),{rootMargin:"50px 0px",threshold:.01}),document.querySelectorAll("img[data-src]").forEach((e=>{window.imageObserver.observe(e)}))):function(){const e=document.querySelectorAll("img[data-src]");let t,n;function s(){e.forEach((e=>{if(e.getAttribute("data-src")){const t=e.getBoundingClientRect();if(t.top<=window.innerHeight&&t.bottom>=0&&t.left<=window.innerWidth&&t.right>=0){const t=e.getAttribute("data-src");e.src=t,e.removeAttribute("data-src"),e.onload=()=>{e.style.opacity="0",e.style.transition="opacity 0.3s",e.classList.add("lazy-loaded"),requestAnimationFrame((()=>{e.style.opacity="1"}))}}}}));0===document.querySelectorAll("img[data-src]").length&&(window.removeEventListener("scroll",s),window.removeEventListener("resize",s))}s(),window.addEventListener("scroll",(()=>{t&&clearTimeout(t),t=setTimeout((()=>{s()}),200)})),window.addEventListener("resize",(()=>{n&&clearTimeout(n),n=setTimeout((()=>{s()}),200)}))}()}function h(){if(window.musicAlbums&&window.musicAlbums.length>0){if(!e.albumsList)return void console.warn("Albums list element not found");e.albumsList.innerHTML="",window.musicAlbums.forEach((t=>{const n=document.createElement("div");n.className="album-item",n.dataset.id=t.id,n.innerHTML=`\n                            <div class="album-image">\n                                <img data-src="${t.cover}" alt="${t.name}" loading="lazy">\n                            </div>\n                            <div class="album-info">\n                                <h3 class="album-title">${t.name}</h3>\n                            </div>\n                        `,n.addEventListener("click",(()=>{w(t.id)})),e.albumsList.appendChild(n)}));"mp3"===(new URLSearchParams(window.location.search).get("quality")||"mp3")&&window.neteasePlaylists&&window.neteasePlaylists.length>0&&window.neteasePlaylists.forEach((t=>{const n=document.createElement("div");n.className="album-item",n.dataset.id=t.id,n.innerHTML=`\n                                <div class="album-image">\n                                    <img data-src="${t.cover}" alt="${t.name}" loading="lazy">\n                                </div>\n                                <div class="album-info">\n                                    <h3 class="album-title">${t.name}</h3>\n                                </div>\n                            `,n.addEventListener("click",(()=>{w(t.id)})),e.albumsList.appendChild(n)})),L(),e.albumsList.querySelectorAll(".album-item").forEach(((e,t)=>{e.style.animation="none",e.style.opacity="0",e.offsetWidth,e.style.animation=`bounceIn 0.6s ease-out ${.1*t}s both`}))}}function w(t){const n="true"===sessionStorage.getItem("qualityUserAction");if(t!==a||n)if(t.startsWith("netease_playlist_")){a=t,r=[],c=-1,window.currentLoadingLyrics=null,window.lastLoadedLyricsKey=null;const n=window.neteasePlaylists.find((e=>e.id===t));if(!n)return e.songsListDesktop&&(e.songsListDesktop.innerHTML='<div class="song-item"><div class="song-details"><div class="song-name">未找到网易云歌单配置</div></div></div>'),void(e.songsListMobile&&(e.songsListMobile.innerHTML='<div class="song-item"><div class="song-details"><div class="song-name">未找到网易云歌单配置</div></div></div>'));e.songsListDesktop&&(e.songsListDesktop.innerHTML='<div class="song-item"><div class="song-details"><div class="song-name">正在加载网易云歌单...</div></div></div>'),e.songsListMobile&&(e.songsListMobile.innerHTML='<div class="song-item"><div class="song-details"><div class="song-name">正在加载网易云歌单...</div></div></div>'),fetch("https://music.zhheo.com/meting-api/?server=netease&type=playlist&id="+n.playlistId+"&r="+Math.random()).then((e=>e.json())).then((t=>{if(t&&t.length>0){if(l=t.map(((e,t)=>({name:e.name||"未知歌曲",artist:e.artist||"未知艺术家",album:e.album||e.artist||"网易云歌单",src:e.url||"",cover:e.pic||"img/default.jpg",neteaseId:e.id,lrc:e.lrc}))),b(),E(),window.scrollTo({top:0,behavior:"smooth"}),l.length>0){const t=e.audioPlayer.src;l.some((e=>e.src===t))||(s=0,M(l[s]),i&&e.audioPlayer.addEventListener("loadedmetadata",(function t(){x(),e.audioPlayer.removeEventListener("loadedmetadata",t)})))}}else e.songsListDesktop&&(e.songsListDesktop.innerHTML='<div class="song-item"><div class="song-details"><div class="song-name">加载网易云歌单失败</div></div></div>'),e.songsListMobile&&(e.songsListMobile.innerHTML='<div class="song-item"><div class="song-details"><div class="song-name">加载网易云歌单失败</div></div></div>')})).catch((t=>{console.error("加载网易云歌单失败:",t),e.songsListDesktop&&(e.songsListDesktop.innerHTML='<div class="song-item"><div class="song-details"><div class="song-name">加载网易云歌单失败</div></div></div>'),e.songsListMobile&&(e.songsListMobile.innerHTML='<div class="song-item"><div class="song-details"><div class="song-name">加载网易云歌单失败</div></div></div>')}))}else{if(a=t,r=[],c=-1,window.currentLoadingLyrics=null,window.lastLoadedLyricsKey=null,window.musicAlbums){const n=window.musicAlbums.find((e=>e.id===t));if(n){l=[...n.songs];if("true"===sessionStorage.getItem("qualityUserAction")&&e.audioPlayer.src){const e=sessionStorage.getItem("currentSongName");if(e){const t=l.findIndex((t=>t.name===e||t.name.includes(e)||e.includes(t.name)));-1!==t&&(s=t)}b(),E()}}}if((!sessionStorage.getItem("qualityUserAction")||"true"!==sessionStorage.getItem("qualityUserAction"))&&(b(),E(),window.scrollTo({top:0,behavior:"smooth"}),l.length>0)){const t=e.audioPlayer.src;l.some((e=>e.src===t))||(s=0,M(l[s]),i&&e.audioPlayer.addEventListener("loadedmetadata",(function t(){x(),e.audioPlayer.removeEventListener("loadedmetadata",t)})))}}}function b(){const t=e.songsListDesktop,n=e.songsListMobile;t&&n?(t.style.animation="none",n.style.animation="none",t.offsetWidth,n.offsetWidth,t.style.animation="slideInUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)",n.style.animation="slideInUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)"):console.warn("Song list elements not found for animation")}function E(){if(!e.songsListDesktop||!e.songsListMobile)return void console.warn("Song list elements not found for rendering");if(e.songsListDesktop.innerHTML="",e.songsListMobile.innerHTML="",0===l.length){const t=document.createElement("div");return t.className="song-item",t.innerHTML='\n                        <div class="song-details">\n                            <div class="song-name">暂无歌曲</div>\n                        </div>\n                    ',e.songsListDesktop.appendChild(t),void e.songsListMobile.appendChild(t.cloneNode(!0))}const t=document.createDocumentFragment(),n=document.createDocumentFragment();l.forEach(((i,o)=>{const l=sessionStorage.getItem("currentSongName");let r,c=!1;if(c="true"===sessionStorage.getItem("qualityUserAction")&&l?i.name===l||i.name.includes(l)||l.includes(i.name):e.audioPlayer.src.includes(i.src),c&&(s=o),a&&a.startsWith("netease_playlist_"))r=i.album||"未知专辑";else{const e=window.musicAlbums.find((e=>e.id===a));r=e?e.name:"未知专辑"}const d="flac"===(new URLSearchParams(window.location.search).get("quality")||"mp3")?"FLAC":"MP3",u=`\n                        <div class="song-number">${o+1}</div>\n                        <div class="song-details">\n                            <div class="song-name">${i.name}</div>\n                            <div class="song-artist-name">${r}</div>\n                        </div>\n                        <div class="quality-badge">${d}</div>\n                    `,m=document.createElement("div");m.className="song-item",m.dataset.index=o,c&&m.classList.add("active"),m.innerHTML=u,t.appendChild(m);const g=m.cloneNode(!0);n.appendChild(g)})),e.songsListDesktop.appendChild(t),e.songsListMobile.appendChild(n),function(){const t=e.songsListDesktop.querySelectorAll(".song-item"),n=e.songsListMobile.querySelectorAll(".song-item");[...t,...n].forEach(((e,t)=>{e.style.animation="none",e.style.opacity="0",e.offsetWidth,e.style.animation=`fadeInRight 0.5s ease-out ${.05*t}s both`}))}()}function P(){if(e.songsListDesktop.innerHTML="",e.songsListMobile.innerHTML="",0===l.length){const t=document.createElement("div");return t.className="song-item",t.innerHTML='\n                        <div class="song-details">\n                            <div class="song-name">暂无歌曲</div>\n                        </div>\n                    ',e.songsListDesktop.appendChild(t),void e.songsListMobile.appendChild(t.cloneNode(!0))}const t=document.createDocumentFragment(),n=document.createDocumentFragment();l.forEach(((i,o)=>{const l=sessionStorage.getItem("currentSongName");let r,c=!1;if(c="true"===sessionStorage.getItem("qualityUserAction")&&l?i.name===l||i.name.includes(l)||l.includes(i.name):e.audioPlayer.src.includes(i.src),c&&(s=o),a&&a.startsWith("netease_playlist_"))r=i.album||"未知专辑";else{const e=window.musicAlbums.find((e=>e.id===a));r=e?e.name:"未知专辑"}const d="flac"===(new URLSearchParams(window.location.search).get("quality")||"mp3")?"FLAC":"MP3",u=`\n                        <div class="song-number">${o+1}</div>\n                        <div class="song-details">\n                            <div class="song-name">${i.name}</div>\n                            <div class="song-artist-name">${r}</div>\n                        </div>\n                        <div class="quality-badge">${d}</div>\n                    `,m=document.createElement("div");m.className="song-item",m.dataset.index=o,c&&m.classList.add("active"),m.innerHTML=u,t.appendChild(m);const g=m.cloneNode(!0);n.appendChild(g)})),e.songsListDesktop.appendChild(t),e.songsListMobile.appendChild(n)}function C(t){const n=t.target.closest(".song-item");if(!n)return;const o=parseInt(n.dataset.index);if(isNaN(o)||o<0||o>=l.length)return;s=o;const a=new URLSearchParams(window.location.search).get("quality")||"mp3",d=l[s];r=[],c=-1,window.currentLoadingLyrics=null,window.lastLoadedLyricsKey=null;const u=d.src.startsWith("http")?d.src:`${window.location.origin}/${d.src}`,m=new URL(u);m.searchParams.has("quality")||m.searchParams.set("quality",a);const g={...d,src:m.toString()},y=new URL(e.audioPlayer.src,window.location.origin);if(e.audioPlayer.src&&y.pathname===m.pathname&&y.search===m.search&&!i)return void x();I(),M(g);const v=function(){S(),x(),e.audioPlayer.removeEventListener("loadedmetadata",v),e.audioPlayer.removeEventListener("error",p)},p=function(){S(),B("音频加载失败，请检查网络连接"),e.audioPlayer.removeEventListener("loadedmetadata",v),e.audioPlayer.removeEventListener("error",p)};e.audioPlayer.addEventListener("loadedmetadata",v),e.audioPlayer.addEventListener("error",p)}function I(){if(e.playPauseBtn&&e.playIcon&&e.pauseIcon){if(!e.playPauseBtn.classList.contains("loading")&&(e.playPauseBtn.classList.add("loading"),e.playIcon.style.display="none",e.pauseIcon.style.display="none",!e.playPauseBtn.querySelector(".loading-indicator"))){const t=document.createElement("div");t.className="loading-indicator",t.innerHTML='<svg class="svg-icon" style="animation: spin 1s linear infinite;"><use href="#icon-play"></use></svg>',e.playPauseBtn.appendChild(t)}}else console.warn("Play button elements not found")}function S(){if(!e.playPauseBtn||!e.playIcon||!e.pauseIcon)return void console.warn("Play button elements not found for hiding loading state");e.playPauseBtn.classList.remove("loading");e.playPauseBtn.querySelectorAll(".loading-indicator").forEach((e=>e.remove())),i?(e.playIcon.style.display="none",e.pauseIcon.style.display="block"):(e.playIcon.style.display="block",e.pauseIcon.style.display="none")}function B(e){const t=document.createElement("div");t.className="error-toast",t.innerHTML=`\n                    <i class="fa fa-exclamation-circle"></i>\n                    <span>${e}</span>\n                `,document.body.appendChild(t),setTimeout((()=>{t.classList.add("fade-out"),setTimeout((()=>{t.parentNode&&t.parentNode.removeChild(t)}),300)}),3e3)}function M(t){if(!t)return;const n=new URL(e.audioPlayer.src,window.location.origin),s=new URL(t.src,window.location.origin);if(e.audioPlayer.src&&n.pathname===s.pathname&&n.search===s.search)return console.log("歌曲已在播放器中，跳过重复加载:",t.name),e.songTitleElement.textContent=t.name,e.lyricsSongTitleElement&&(e.lyricsSongTitleElement.textContent=t.name),T(),void(i||x());if(e.songTitleElement.textContent=t.name,e.lyricsSongTitleElement&&(e.lyricsSongTitleElement.textContent=t.name),a&&a.startsWith("netease_playlist_"))e.songArtistElement.textContent=t.album||"未知专辑",e.lyricsSongArtistElement.textContent=t.album||"未知专辑";else{const t=window.musicAlbums.find((e=>e.id===a));e.songArtistElement.textContent=t?t.name:"未知专辑",e.lyricsSongArtistElement.textContent=t?t.name:"未知专辑"}let o="img/1.jpg";if(t.cover)o=t.cover;else if(a&&window.musicAlbums){const e=window.musicAlbums.find((e=>e.id===a));if(e&&e.cover)o=e.cover;else for(const e of window.musicAlbums)if(e.songs&&e.songs.some((e=>e.src===t.src))&&e.cover){o=e.cover;break}}if(e.coverImage){const t=o;f===t&&"img/1.jpg"!==t&&"img/default.jpg"!==t?console.log("封面相同，跳过重复加载:",t):"img/default.jpg"!==o?(e.coverImage.removeAttribute("src"),e.coverImage.setAttribute("data-src",o),!function(e){const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}(e.coverImage)&&window.imageObserver?window.imageObserver.observe(e.coverImage):(e.coverImage.src=o,e.coverImage.removeAttribute("data-src"),e.coverImage.onload=()=>{e.coverImage.style.opacity="0",e.coverImage.style.transition="opacity 0.3s",e.coverImage.classList.add("lazy-loaded"),requestAnimationFrame((()=>{e.coverImage.style.opacity="1"})),f=o})):(e.coverImage.src=o,f=o)}else console.warn("Cover image element not found");if(e.audioPlayer){const n=new URLSearchParams(window.location.search).get("quality")||"mp3",s=t.src.startsWith("http")?t.src:new URL(t.src,window.location.origin).href,i=new URL(s);i.searchParams.has("quality")||i.searchParams.set("quality",n),e.audioPlayer.src=i.toString(),T(),F(),d=[],j(),async function(t){if(!t)return;const n=`${t.name}-${t.album||t.albumId||"unknown"}`;if(m.has(n))return d=m.get(n),void _();e.lyricsContent&&(e.lyricsContent.innerHTML='<div class="lyrics-empty">加载歌词中...</div>');try{let e=[];if(t.lrc)try{const n=await fetch(t.lrc);if(n.ok){const t=await n.text();t.trim()&&(e=W(t))}}catch(e){console.warn("加载本地歌词文件失败:",e)}if(0===e.length&&t.neteaseId)try{const n=`https://music.zhheo.com/meting-api/?server=netease&type=lrc&id=${t.neteaseId}`,s=await fetch(n);if(s.ok){const t=await s.text();!t.trim()||t.includes("error")||t.includes("暂无歌词")||(e=W(t))}}catch(e){console.warn("加载网易云歌词失败:",e)}m.set(n,e),d=e}catch(e){console.error("加载歌词时出错:",e),d=[]}_()}(t),v&&e.audioPlayer.removeEventListener("error",v),y&&e.audioPlayer.removeEventListener("loadedmetadata",y),v=k,e.audioPlayer.addEventListener("error",v),y=function(){!function(){if(!e.audioPlayer||!e.totalTimeElement)return void console.warn("更新总时长所需的关键元素未找到");const t=e.audioPlayer.duration;t&&!isNaN(t)&&(e.totalTimeElement.textContent=$(t))}()},e.audioPlayer.addEventListener("loadedmetadata",y)}else console.warn("Audio player element not found"),S()}function k(e){S();const t=e.target.error;let n="音频加载失败";switch(t.code){case t.MEDIA_ERR_ABORTED:n="音频加载被中止";break;case t.MEDIA_ERR_NETWORK:n="网络错误，音频加载失败";break;case t.MEDIA_ERR_DECODE:n="音频解码失败";break;case t.MEDIA_ERR_SRC_NOT_SUPPORTED:n="音频格式不支持";break;default:n="音频加载失败，请检查网络连接"}B(n),console.error("音频加载错误:",t)}function T(){document.querySelectorAll(".song-item.active").forEach((e=>e.classList.remove("active")));document.querySelectorAll(`.song-item[data-index="${s}"]`).forEach((e=>e.classList.add("active")))}function x(){if(0===l.length)return;if(I(),!(e.audioPlayer&&e.playIcon&&e.pauseIcon&&e.albumCover))return console.warn("播放所需的关键元素未找到"),void S();const n=e.audioPlayer.play();if(void 0!==n)n.then((()=>{S(),i=!0,e.playIcon.style.display="none",e.pauseIcon.style.display="block",e.albumCover.classList.add("playing"),t()})).catch((e=>{S(),console.error("播放失败:",e);let t="播放失败";t="NotAllowedError"===e.name?"浏览器阻止了自动播放，请点击播放按钮":"NotSupportedError"===e.name?"音频格式不支持":"播放失败，请重试",B(t)}));else try{e.audioPlayer.play(),i=!0,e.playIcon.style.display="none",e.pauseIcon.style.display="block",e.albumCover.classList.add("playing"),S(),t()}catch(e){S(),console.error("播放失败:",e),B("播放失败，请重试")}}function A(){if(0!==l.length){if(2===o){const e=Math.floor(Math.random()*l.length);s=e}else if(3===o)s=(s+1)%l.length;else if(0===o)s=(s+1)%l.length;else{if(!(s<l.length-1))return;s++}M(l[s]),setTimeout((()=>{if(e.audioPlayer&&e.audioPlayer.readyState>=2)x();else{const t=function(){x(),e.audioPlayer.removeEventListener("loadedmetadata",t)};e.audioPlayer.addEventListener("loadedmetadata",t)}}),100)}}function q(){if(0!==l.length){if(2===o){const e=Math.floor(Math.random()*l.length);s=e}else if(3===o)s=(s-1+l.length)%l.length;else if(0===o)s=(s-1+l.length)%l.length;else{if(!(s>0))return;s--}M(l[s]),setTimeout((()=>{if(e.audioPlayer&&e.audioPlayer.readyState>=2)x();else{const t=function(){x(),e.audioPlayer.removeEventListener("loadedmetadata",t)};e.audioPlayer.addEventListener("loadedmetadata",t)}}),100)}}function H(){if(!e.audioPlayer||!e.progress)return void console.warn("更新进度所需的关键元素未找到");const{duration:t,currentTime:n}=e.audioPlayer;if(t&&!isNaN(t)){const s=n/t*100;e.progress.style.width=`${s}%`}!function(){if(!e.audioPlayer||!e.currentTimeElement)return void console.warn("更新当前时间所需的关键元素未找到");const t=e.audioPlayer.currentTime;e.currentTimeElement.textContent=$(t)}(),z()}function $(e){const t=Math.floor(e/60),n=Math.floor(e%60);return`${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}function R(t){if(!e.progressBar||!e.audioPlayer)return void console.warn("设置进度条所需的关键元素未找到");const n=e.progressBar.clientWidth,s=e.progressBar.getBoundingClientRect(),i=t.clientX-s.left,o=e.audioPlayer.duration;if(o){const t=i/n*o;e.audioPlayer.currentTime=t}}function D(){if(e.modeIcon&&e.playModeBtn)switch(o=0===o?3:3===o?2:2===o?1:0,o){case 0:e.modeIcon.innerHTML='<path d="M8 20V21.9324C8 22.2086 7.77614 22.4324 7.5 22.4324C7.38303 22.4324 7.26977 22.3914 7.17991 22.3165L3.06093 18.8841C2.84879 18.7073 2.82013 18.392 2.99691 18.1799C3.09191 18.0659 3.23264 18 3.38103 18L18 18C19.1046 18 20 17.1045 20 16V7.99997H22V16C22 18.2091 20.2091 20 18 20H8ZM16 3.99997V2.0675C16 1.79136 16.2239 1.5675 16.5 1.5675C16.617 1.5675 16.7302 1.60851 16.8201 1.68339L20.9391 5.11587C21.1512 5.29266 21.1799 5.60794 21.0031 5.82008C20.9081 5.93407 20.7674 5.99998 20.619 5.99998L6 5.99997C4.89543 5.99997 4 6.8954 4 7.99997V16H2V7.99997C2 5.79083 3.79086 3.99997 6 3.99997H16Z"/>',e.playModeBtn.style.backgroundColor="transparent",e.playModeBtn.style.color="var(--text-secondary)";break;case 1:e.modeIcon.innerHTML='<path d="M17 3.99998V2.0675C17 1.79136 17.2239 1.5675 17.5 1.5675C17.617 1.5675 17.7302 1.60851 17.8201 1.68339L21.9391 5.11587C22.1512 5.29266 22.1799 5.60794 22.0031 5.82008C21.9081 5.93407 21.7674 5.99998 21.619 5.99998H2V3.99998H17ZM2 18H22V20H2V18ZM2 11H22V13H2V11Z"/>',e.playModeBtn.style.backgroundColor="transparent",e.playModeBtn.style.color="var(--text-secondary)";const t=e.playModeBtn.querySelector(".loop-dot");t&&t.remove();break;case 2:e.modeIcon.innerHTML='<path d="M18 17.8832V16L23 19L18 22V19.9095C14.9224 19.4698 12.2513 17.4584 11.0029 14.5453L11 14.5386L10.9971 14.5453C9.57893 17.8544 6.32508 20 2.72483 20H2V18H2.72483C5.52503 18 8.05579 16.3312 9.15885 13.7574L9.91203 12L9.15885 10.2426C8.05579 7.66878 5.52503 6 2.72483 6H2V4H2.72483C6.32508 4 9.57893 6.14557 10.9971 9.45473L11 9.46141L11.0029 9.45473C12.2513 6.5416 14.9224 4.53022 18 4.09051V2L23 5L18 8V6.11684C15.7266 6.53763 13.7737 8.0667 12.8412 10.2426L12.088 12L12.8412 13.7574C13.7737 15.9333 15.7266 17.4624 18 17.8832Z"/>',e.playModeBtn.style.backgroundColor="transparent",e.playModeBtn.style.color="var(--text-secondary)";break;case 3:e.modeIcon.innerHTML='<path d="M8 20V21.9325C8 22.2086 7.77614 22.4325 7.5 22.4325C7.38303 22.4325 7.26977 22.3915 7.17991 22.3166L3.06093 18.8841C2.84879 18.7073 2.82013 18.392 2.99691 18.1799C3.09191 18.0659 3.23264 18 3.38103 18L18 18C19.1046 18 20 17.1046 20 16V8H22V16C22 18.2091 20.2091 20 18 20H8ZM16 2.0675C16 1.79136 16.2239 1.5675 16.5 1.5675C16.617 1.5675 16.7302 1.60851 16.8201 1.68339L20.9391 5.11587C21.1512 5.29266 21.1799 5.60794 21.0031 5.82008C20.9081 5.93407 20.7674 5.99998 20.619 5.99998L6 6C4.89543 6 4 6.89543 4 8V16H2V8C2 5.79086 3.79086 4 6 4H16V2.0675ZM11 8H13V16H11V10H9V9L11 8Z"/>',e.playModeBtn.style.backgroundColor="transparent",e.playModeBtn.style.color="var(--text-secondary)"}else console.warn("切换播放模式所需的关键元素未找到")}function N(){const e=document.querySelector(".cloud-qr-modal");e&&document.body.removeChild(e);const t=document.createElement("div");t.className="cloud-qr-modal",t.innerHTML='\n                    <div class="qr-modal-content">\n                        <div class="qr-modal-header">\n                            <h3>上传歌曲至网易云盘</h3>\n                            <button class="qr-modal-close">&times;</button>\n                        </div>\n                        <div class="qr-modal-body">\n                            <img src="img/xcx.jpg" alt="云盘二维码" class="qr-code-image">\n                            <p>扫码使用小程序上传歌曲</p>\n                            <p><a href="https://mp.weixin.qq.com/s/pHsFSPTn3Cd7MXV81J4NHg" target="_blank" class="guide-button">使用指南</a></p>\n                        </div>\n                    </div>\n                ',document.body.appendChild(t),setTimeout((()=>{t.style.opacity="1",t.style.visibility="visible"}),10);const n=t.querySelector(".qr-modal-close");n&&n.addEventListener("click",(function(){const e=t.querySelector(".qr-modal-content");e&&(e.style.animation="modalBounceOut 0.4s ease-in forwards"),setTimeout((()=>{document.body.contains(t)&&document.body.removeChild(t)}),400)})),t.addEventListener("click",(function(e){if(e.target===t){const e=t.querySelector(".qr-modal-content");e&&(e.style.animation="modalBounceOut 0.4s ease-in forwards"),setTimeout((()=>{document.body.contains(t)&&document.body.removeChild(t)}),400)}}))}e.audioPlayer?e.audioPlayer.volume=.8:console.warn("Audio player element not found");const V={playPause:null,prev:null,next:null,playMode:null,cloud:null,timeupdate:null,progressClick:null,ended:null,albumCover:null,songClickDesktop:null,songClickMobile:null,lyricsToggle:null};function U(){e.coverPage&&e.lyricsPage?"cover"===g?(e.coverPage.classList.remove("active"),e.lyricsPage.classList.add("active"),g="lyrics"):(e.lyricsPage.classList.remove("active"),e.coverPage.classList.add("active"),g="cover"):console.warn("切换页面所需的关键元素未找到")}function W(e){const t=e.split("\n"),n=[];for(let e=0;e<t.length;e++){const s=t[e].trim();if(!s)continue;const i=s.match(/^\[(\d{1,2}):(\d{1,2})(?:\.(\d{2,3}))?\]<(?:(\d{1,2}):(\d{1,2})(?:\.(\d{2,3}))?>)?(.*)$/);if(i){const e=parseInt(i[1]),t=parseInt(i[2]);let s=0;i[3]&&(s=2===i[3].length?10*parseInt(i[3]):parseInt(i[3]));let o=i[7]||"";o=o.replace(/<\d{1,2}:\d{1,2}(?:\.\d{2,3})?>/g,""),o=o.trim();const a=60*e+t+s/1e3;n.push({time:a,text:o||"♪"});continue}const o=s.match(/^\[(\d{1,2}):(\d{1,2})(?:\.(\d{2,3}))?\](.*)$/);if(o){const e=parseInt(o[1]),t=parseInt(o[2]);let s=0;o[3]&&(s=2===o[3].length?10*parseInt(o[3]):parseInt(o[3]));const i=o[4].trim(),a=60*e+t+s/1e3;n.push({time:a,text:i||"♪"})}}return n.sort(((e,t)=>e.time-t.time)),n}function _(){if(!e.lyricsContent)return;if(e.lyricsContent.classList.remove("single-line"),j(),0===d.length)return void(e.lyricsContent.innerHTML='<div class="lyrics-empty">暂无歌词</div>');(1===d.length||2===d.length&&"♪"===d[1].text||2===d.length&&"纯音乐"===d[1].text||2===d.length&&"无歌词"===d[1].text)&&e.lyricsContent.classList.add("single-line");let t="";for(let e=0;e<d.length;e++)t+=`<div class="lyrics-line" data-index="${e}" data-time="${d[e].time}">${d[e].text}</div>`;e.lyricsContent.innerHTML=t,u=-1,i&&z()}function j(){const e=document.getElementById("lyrics-indicator"),t=document.getElementById("lyrics-indicator-2"),n=!(!(d.length>0)||1===d.length&&"♪"===d[0].text||1===d.length&&"纯音乐"===d[0].text||1===d.length&&"无歌词"===d[0].text);e&&(n?(e.classList.add("active"),e.title="有歌词"):(e.classList.remove("active"),e.title="无歌词")),t&&(n?(t.classList.add("active"),t.title="有歌词"):(t.classList.remove("active"),t.title="无歌词"))}function z(){if(!e.audioPlayer||0===d.length)return;const t=e.audioPlayer.currentTime;let n=-1;for(let e=d.length-1;e>=0;e--)if(t>=d[e].time){n=e;break}if(n!==u){if(e.lyricsContent.querySelectorAll(".lyrics-line").forEach((e=>{e.classList.remove("active","past","next")})),n>=0){const t=e.lyricsContent.querySelector(`.lyrics-line[data-index="${n}"]`);if(t){t.classList.add("active");for(let t=0;t<n;t++){const n=e.lyricsContent.querySelector(`.lyrics-line[data-index="${t}"]`);n&&n.classList.add("past")}for(let t=n+1;t<d.length;t++){const n=e.lyricsContent.querySelector(`.lyrics-line[data-index="${t}"]`);n&&n.classList.add("next")}const s=e.lyricsContent,i=s.clientHeight,o=t.clientHeight,a=t.offsetTop-i/2+o/2;s.scrollTop=a}}u=n}}function F(){if(!("mediaSession"in navigator))return;const t=l[s];if(!t)return;const n=`${t.name}-${t.artist}-${a}`;if(p===n){if(d.length>0){const n=e.audioPlayer?e.audioPlayer.currentTime:0;let s="";for(let e=0;e<d.length&&d[e].time<=n;e++)s=d[e].text;if(s&&navigator.mediaSession.metadata){const e=navigator.mediaSession.metadata.artwork;navigator.mediaSession.metadata=new MediaMetadata({title:t.name||"未知歌曲",artist:s,album:t.album||a||"未知专辑",artwork:e})}}return}p=n;let i="";if(d.length>0){const t=e.audioPlayer?e.audioPlayer.currentTime:0;for(let e=0;e<d.length&&d[e].time<=t;e++)i=d[e].text}let o="img/1.jpg";if(t.cover)o=t.cover;else if(a&&window.musicAlbums){const e=window.musicAlbums.find((e=>e.id===a));e&&e.cover&&(o=e.cover)}if(!o.startsWith("http")&&!o.startsWith("//")){o=window.location.origin+window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/"))+"/"+o}const r=new MediaMetadata({title:t.name||"未知歌曲",artist:t.artist||"未知艺术家",album:t.album||a||"未知专辑",artwork:[{src:o,sizes:"96x96",type:"image/jpeg"},{src:o,sizes:"128x128",type:"image/jpeg"},{src:o,sizes:"192x192",type:"image/jpeg"},{src:o,sizes:"256x256",type:"image/jpeg"},{src:o,sizes:"384x384",type:"image/jpeg"},{src:o,sizes:"512x512",type:"image/jpeg"}]});navigator.mediaSession.metadata=r,i&&(navigator.mediaSession.metadata=new MediaMetadata({title:t.name||"未知歌曲",artist:i,album:t.album||a||"未知专辑",artwork:r.artwork}))}function O(e,t){return"flac"!==t||!["网易云歌单","工体东路没有人","108个关键词"].includes(e)}function Q(){const e=document.getElementById("quality-modal");if(e){e.classList.add("active");const t=new URLSearchParams(window.location.search).get("quality")||"mp3",n=document.getElementById("quality-hq"),i=document.getElementById("quality-sq");n.classList.remove("selected","unavailable","current"),i.classList.remove("selected","unavailable","current");const o=l[s];if(a&&a.startsWith("netease_playlist_"))i.classList.add("unavailable");else if(o&&a&&window.musicAlbums){const e=window.musicAlbums.find((e=>e.id===a));if(e){const s=O(e.name,"flac");"mp3"!==t||s||i.classList.add("unavailable");const o=O(e.name,"mp3");"flac"!==t||o||n.classList.add("unavailable")}}"mp3"===t?n.classList.add("selected","current"):"flac"===t&&i.classList.add("selected","current");const r=document.getElementById("quality-modal-close");r&&(r.onclick=function(){e.classList.remove("active")}),e.onclick=function(t){t.target===e&&e.classList.remove("active")},n&&(n.onclick=function(){if(!this.classList.contains("current"))if(this.classList.contains("unavailable")){const e=window.musicAlbums.find((e=>e.id===a));X(`专辑"${e?e.name:"当前专辑"}"没有HQ音质版本`)}else Z("mp3"),e.classList.remove("active")}),i&&(i.onclick=function(){if(!this.classList.contains("current"))if(this.classList.contains("unavailable")){if(a&&a.startsWith("netease_playlist_"))X("网易云歌单不支持SQ无损音质");else{const e=window.musicAlbums.find((e=>e.id===a));X(`专辑"${e?e.name:"当前专辑"}"没有SQ音质版本`)}}else Z("flac"),e.classList.remove("active")})}}function Z(t){const n=l[s];if(!n)return;const o=n.name,d=(n.artist,i),u=e.audioPlayer.currentTime;sessionStorage.setItem("qualityUserAction","true"),sessionStorage.setItem("currentSongName",o),sessionStorage.setItem("wasPlaying",d.toString()),sessionStorage.setItem("currentTime",u.toString());const m="mp3"===t?"mp3list-script":"flaclist-script",g="mp3"===t?"js/mp3list.js?t=2025102101":"js/flaclist.js?t=2025102101",y=document.getElementById("mp3list-script")||document.getElementById("flaclist-script");y&&y.remove();const v=document.createElement("script");v.id=m,v.src=g,v.onload=function(){const n=new URL(window.location);n.searchParams.set("quality",t),window.history.pushState({},"",n),h();const i=sessionStorage.getItem("currentSongName"),o="true"===sessionStorage.getItem("wasPlaying"),d=parseFloat(sessionStorage.getItem("currentTime")||"0");setTimeout((()=>{if(i&&l.length>0){let n=null,u=null,m=-1;if(a&&window.musicAlbums){const e=window.musicAlbums.find((e=>e.id===a));if(e&&e.songs){const t=e.songs.findIndex((e=>e.name===i||e.name.includes(i)||i.includes(e.name)));-1!==t&&(n=e.songs[t],u=a,m=t)}}if(n&&null!==u){sessionStorage.setItem("qualityUserAction","true");new URLSearchParams(window.location.search).get("quality");w(u),setTimeout((()=>{const e=window.musicAlbums.find((e=>e.id===u));e&&e.songs&&(l=[...e.songs],E())}),100),setTimeout((()=>{r=[],c=-1,window.currentLoadingLyrics=null,window.lastLoadedLyricsKey=null;const t=new URLSearchParams(window.location.search).get("quality")||"mp3",n=window.musicAlbums.find((e=>e.id===u));if(n&&n.songs&&n.songs[m]){s=m;const i=n.songs[m],a=i.src.startsWith("http")?i.src:`${window.location.origin}/${i.src}`,l=new URL(a);l.searchParams.has("quality")||l.searchParams.set("quality",t);const r={...i,src:l.toString()};if(e.audioPlayer&&(e.audioPlayer.src=r.src,e.audioPlayer.load()),o){const t=()=>{e.audioPlayer&&e.audioPlayer.readyState>=2?(e.audioPlayer.currentTime=d,x()):setTimeout(t,100)};setTimeout(t,100)}else{const t=()=>{e.audioPlayer&&e.audioPlayer.readyState>=2?e.audioPlayer.currentTime=d:setTimeout(t,100)};setTimeout(t,100)}}}),500)}else{sessionStorage.setItem("songNotFound","true"),setTimeout((()=>{const e=window.musicAlbums.find((e=>e.id===a));X(`专辑"${e?e.name:"当前专辑"}"中没有"${i}"的${"flac"===t?"SQ":"HQ"}音质版本`)}),1e3);const n="flac"===t?"mp3":"flac",l=new URL(window.location);l.searchParams.set("quality",n),window.history.pushState({},"",l);const r="mp3"===n?"mp3list-script":"flaclist-script",c="mp3"===n?"js/mp3list.js?t=2025102101":"js/flaclist.js?t=2025102101",u=document.getElementById("mp3list-script")||document.getElementById("flaclist-script");u&&u.remove();const m=document.createElement("script");m.id=r,m.src=c,m.onload=function(){h(),setTimeout((()=>{if(a&&window.musicAlbums){const t=window.musicAlbums.find((e=>e.id===a));t&&t.songs&&(w(a),setTimeout((()=>{const n=t.songs.findIndex((e=>e.name===i||e.name.includes(i)||i.includes(e.name)));if(-1!==n)if(s=n,M(t.songs[n]),o){const t=()=>{e.audioPlayer&&e.audioPlayer.readyState>=2?(e.audioPlayer.currentTime=d,x()):setTimeout(t,100)};setTimeout(t,100)}else{const t=()=>{e.audioPlayer&&e.audioPlayer.readyState>=2?e.audioPlayer.currentTime=d:setTimeout(t,100)};setTimeout(t,100)}}),300))}K()}),300)},document.head.appendChild(m)}}else console.log("未找到保存的播放状态，等待用户手动选择专辑");K(),sessionStorage.removeItem("currentSongName"),sessionStorage.removeItem("wasPlaying"),sessionStorage.removeItem("currentTime"),sessionStorage.removeItem("qualityUserAction")}),300)},document.head.appendChild(v)}function K(){const e=new URLSearchParams(window.location.search).get("quality")||"mp3",t="true"===sessionStorage.getItem("qualityUserAction"),n="true"===sessionStorage.getItem("songNotFound");sessionStorage.removeItem("qualityUserAction"),sessionStorage.removeItem("songNotFound");const s=document.getElementById("quality-indicator"),i=document.getElementById("quality-indicator-2");"flac"===e?(s&&(s.classList.add("active"),s.classList.remove("hq-active"),s.textContent="SQ"),i&&(i.classList.add("active"),i.classList.remove("hq-active"),i.textContent="SQ"),console.log("已切换至无损SQ音质歌单"),t&&!n&&X("已切换为无损SQ音质 歌单已更新")):(s&&(s.classList.remove("active"),s.classList.add("hq-active"),s.textContent="HQ"),i&&(i.classList.remove("active"),i.classList.add("hq-active"),i.textContent="HQ"),console.log("已切换至极高HQ音质歌单"),t&&!n&&X("已切换为极高HQ音质 歌单已更新"))}function X(e){const t=document.createElement("div");t.className="notification",t.textContent=e,t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.backgroundColor="var(--bg-card)",t.style.color="var(--primary)",t.style.padding="12px 24px",t.style.borderRadius="var(--radius-md)",t.style.zIndex="10000",t.style.boxShadow="var(--shadow)",t.style.opacity="0",t.style.transition="opacity 0.5s ease, transform 0.5s ease",t.style.fontSize="16px",t.style.fontWeight="500",t.style.whiteSpace="nowrap",t.style.border="1px solid var(--primary)",t.style.backdropFilter="blur(10px)",t.style.webkitBackdropFilter="blur(10px)",document.body.appendChild(t),setTimeout((()=>{t.style.opacity="1",t.style.transform="translate(-50%, -50%) scale(1)"}),100),setTimeout((()=>{t.style.opacity="0",t.style.transform="translate(-50%, -50%) scale(0.95)",setTimeout((()=>{document.body.removeChild(t)}),500)}),5e3)}!function(){e.playPauseBtn&&(V.playPause=()=>{i?function(){if(e.audioPlayer&&e.playIcon&&e.pauseIcon&&e.albumCover)try{e.audioPlayer.pause(),i=!1,e.playIcon.style.display="block",e.pauseIcon.style.display="none",e.albumCover.classList.remove("playing"),e.playPauseBtn&&e.playPauseBtn.classList.remove("loading"),t()}catch(e){console.error("暂停失败:",e)}else console.warn("暂停所需的关键元素未找到")}():x()},e.playPauseBtn.addEventListener("click",V.playPause)),e.prevBtn&&(V.prev=q,e.prevBtn.addEventListener("click",V.prev)),e.nextBtn&&(V.next=A,e.nextBtn.addEventListener("click",V.next)),e.playModeBtn&&(V.playMode=D,e.playModeBtn.addEventListener("click",V.playMode),e.playModeBtn.addEventListener("mouseenter",(function(){this.style.background="rgba(212, 175, 55, 0.15)",this.style.color="var(--primary)",this.style.border="1px solid rgba(212, 175, 55, 0.4)",this.style.boxShadow="0 0 15px rgba(212, 175, 55, 0.3)",this.style.borderRadius="var(--radius-md)",this.style.transform="translateY(-2px)"})),e.playModeBtn.addEventListener("mouseleave",(function(){this.style.background="rgba(255, 255, 255, 0.05)",this.style.color="var(--text-secondary)",this.style.border="1px solid rgba(212, 175, 55, 0.2)",this.style.boxShadow="none",this.style.borderRadius="var(--radius-md)",this.style.transform="none"}))),e.cloudBtn&&(V.cloud=N,e.cloudBtn.addEventListener("click",V.cloud));const n=document.getElementById("quality-indicator");n&&(V.quality=Q,n.addEventListener("click",V.quality)),e.audioPlayer&&(V.timeupdate=H,e.audioPlayer.addEventListener("timeupdate",V.timeupdate),V.ended=function(){3===o?(e.audioPlayer.currentTime=0,x()):A(),setTimeout((()=>{F(),t()}),100)},e.audioPlayer.addEventListener("ended",V.ended)),e.progressBar&&(V.progressClick=R,e.progressBar.addEventListener("click",V.progressClick)),e.songsListDesktop&&(V.songClickDesktop=C,e.songsListDesktop.addEventListener("click",V.songClickDesktop)),e.songsListMobile&&(V.songClickMobile=C,e.songsListMobile.addEventListener("click",V.songClickMobile))}(),window.addEventListener("beforeunload",(function(){V.playPause&&e.playPauseBtn.removeEventListener("click",V.playPause),V.prev&&e.prevBtn.removeEventListener("click",V.prev),V.next&&e.nextBtn.removeEventListener("click",V.next),V.playMode&&e.playModeBtn.removeEventListener("click",V.playMode),V.cloud&&e.cloudBtn.removeEventListener("click",V.cloud),V.timeupdate&&e.audioPlayer.removeEventListener("timeupdate",V.timeupdate),V.progressClick&&e.progressBar.removeEventListener("click",V.progressClick),V.ended&&e.audioPlayer.removeEventListener("ended",V.ended),V.albumCover&&e.albumCover.removeEventListener("click",V.albumCover),V.songClickDesktop&&e.songsListDesktop.removeEventListener("click",V.songClickDesktop),V.songClickMobile&&e.songsListMobile.removeEventListener("click",V.songClickMobile)})),h(),function(){if(!e.mobileSongsCollapse||!e.mobileSongsContainer)return;let t=!1,n=!1,s=null;const i=(o=function(){n||(t=!t,n=!0,requestAnimationFrame((()=>{t?e.mobileSongsContainer.classList.add("collapsed"):e.mobileSongsContainer.classList.remove("collapsed"),setTimeout((()=>{n=!1}),320)})))},a=30,function(){const e=this,t=arguments;clearTimeout(s),s=setTimeout((()=>{o.apply(e,t)}),a)});var o,a;e.mobileSongsCollapse.addEventListener("click",(function(){i()})),e.mobileSongsContainer.querySelector(".songs-header").addEventListener("click",(function(e){e.target.closest(".collapse-btn")||i()}))}(),function(){if(!e.progressBar||!e.audioPlayer)return void console.warn("初始化进度条拖拽所需的关键元素未找到");let t=!1;e.progressBar.addEventListener("mousedown",(function(n){t=!0,e.progressBar.classList.add("dragging"),R(n)})),document.addEventListener("mousemove",(function(n){if(t){const t=e.progressBar.clientWidth,s=e.progressBar.getBoundingClientRect(),i=n.clientX-s.left,o=e.audioPlayer.duration;if(o){const n=Math.max(0,Math.min(t,i))/t*o;e.audioPlayer.currentTime=n}}})),document.addEventListener("mouseup",(function(){t&&(t=!1,e.progressBar.classList.remove("dragging"))})),e.progressBar.addEventListener("touchstart",(function(n){t=!0;const s=n.touches[0],i=e.progressBar.getBoundingClientRect(),o=s.clientX-i.left,a=e.progressBar.clientWidth,l=e.audioPlayer.duration;if(l){const t=Math.max(0,Math.min(a,o))/a*l;e.audioPlayer.currentTime=t}})),document.addEventListener("touchmove",(function(n){if(t){const t=n.touches[0],s=e.progressBar.getBoundingClientRect(),i=t.clientX-s.left,o=e.progressBar.clientWidth,a=e.audioPlayer.duration;if(a){const t=Math.max(0,Math.min(o,i))/o*a;e.audioPlayer.currentTime=t}}})),document.addEventListener("touchend",(function(){t&&(t=!1,e.progressBar.classList.remove("dragging"))}))}(),e.backToTopBtn&&(window.addEventListener("scroll",(function(){window.scrollY>300?e.backToTopBtn.classList.add("visible"):e.backToTopBtn.classList.remove("visible")})),e.backToTopBtn.addEventListener("click",(function(){window.scrollTo({top:0,behavior:"smooth"})}))),o=0,e.modeIcon&&e.playModeBtn&&(e.modeIcon.innerHTML='<path d="M8 20V21.9324C8 22.2086 7.77614 22.4324 7.5 22.4324C7.38303 22.4324 7.26977 22.3914 7.17991 22.3165L3.06093 18.8841C2.84879 18.7073 2.82013 18.392 2.99691 18.1799C3.09191 18.0659 3.23264 18 3.38103 18L18 18C19.1046 18 20 17.1045 20 16V7.99997H22V16C22 18.2091 20.2091 20 18 20H8ZM16 3.99997V2.0675C16 1.79136 16.2239 1.5675 16.5 1.5675C16.617 1.5675 16.7302 1.60851 16.8201 1.68339L20.9391 5.11587C21.1512 5.29266 21.1799 5.60794 21.0031 5.82008C20.9081 5.93407 20.7674 5.99998 20.619 5.99998L6 5.99997C4.89543 5.99997 4 6.8954 4 7.99997V16H2V7.99997C2 5.79083 3.79086 3.99997 6 3.99997H16Z"/>',e.playModeBtn.style.backgroundColor="transparent",e.playModeBtn.style.color="var(--text-secondary)"),window.musicAlbums&&window.musicAlbums.length>0?(w(window.musicAlbums[0].id),l.length>0&&!e.audioPlayer.src&&M(l[0])):window.neteasePlaylists&&window.neteasePlaylists.length>0?w(window.neteasePlaylists[0].id):P(),function(){if(!e.albumCover||!e.coverPage||!e.lyricsPage)return;e.albumCover.addEventListener("click",(function(){U()}));const t=document.getElementById("lyrics-indicator"),n=document.getElementById("lyrics-indicator-2"),s=function(){"cover"===g&&U()};t&&t.addEventListener("click",s);n&&n.addEventListener("click",s);e.lyricsPage.addEventListener("click",(function(e){if("lyrics"===g){const t=document.getElementById("progress-bar"),n=document.querySelector(".progress-container");if(e.target===t||e.target===n||t.contains(e.target)||n.contains(e.target))return;U()}})),e.coverPage.classList.add("active"),e.lyricsPage.classList.remove("active"),g="cover"}(),t=function(){"mediaSession"in navigator&&(navigator.mediaSession.playbackState=i?"playing":"paused")},n=function(e,t){let n;return function(){const s=arguments,i=this;n||(e.apply(i,s),n=!0,setTimeout((()=>n=!1),t))}}((function(){"mediaSession"in navigator&&i&&d.length>0&&F()}),1e3),"mediaSession"in navigator?("mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("play",(function(){e.audioPlayer.paused&&(e.audioPlayer.play(),i=!0,updatePlayPauseButton(),F())})),navigator.mediaSession.setActionHandler("pause",(function(){e.audioPlayer.paused||(e.audioPlayer.pause(),i=!1,updatePlayPauseButton())})),navigator.mediaSession.setActionHandler("previoustrack",(function(){playPrevious()})),navigator.mediaSession.setActionHandler("nexttrack",(function(){playNext()})),navigator.mediaSession.setActionHandler("seekto",(function(t){t.fastSeek&&"fastSeek"in e.audioPlayer?e.audioPlayer.fastSeek(t.seekTime):e.audioPlayer.currentTime=t.seekTime})),navigator.mediaSession.setActionHandler("stop",(function(){e.audioPlayer.pause(),e.audioPlayer.currentTime=0,i=!1,updatePlayPauseButton()}))),e.audioPlayer.addEventListener("play",t),e.audioPlayer.addEventListener("pause",t),e.audioPlayer.addEventListener("ended",t),e.audioPlayer.addEventListener("timeupdate",(function(){i&&d.length>0&&n()})),document.addEventListener("visibilitychange",(function(){document.hidden&&i&&F()})),console.log("MediaSession API 初始化完成")):console.log("当前浏览器不支持MediaSession API"),K()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initMusicPlayer):initMusicPlayer();
