function initializeApp(){u();let o=window.videoData||{},t=window.categories||[],d=null,s="";function c(){return d||(d=new DPlayer({container:document.getElementById("dplayer-container"),live:!1,autoplay:!1,theme:"#d4af37",loop:!1,lang:"zh-cn",hotkey:!0,volume:.7,playbackSpeed:[.5,.75,1,1.25,1.5,2],mutex:!0,contextmenu:[],video:{url:"",pic:"https://v.1701701.xyz/img/bg.jpg"},errorHandler:function(e){console.error("DPlayer error:",e),v("视频播放失败: "+e.message)},mobileControls:!0,hideControlsAfter:1e3,autoHide:!0}),u(),setTimeout(()=>{d&&d.controller&&d.controller.hide()},1e3)),d}function u(){setTimeout(()=>{var e=document.getElementById("dplayer-container");e&&e.addEventListener("contextmenu",function(e){return e.preventDefault(),!1}),document.querySelectorAll("video").forEach(e=>{e.addEventListener("contextmenu",function(e){return e.preventDefault(),!1}),e.addEventListener("dragstart",function(e){return e.preventDefault(),!1})}),document.addEventListener("contextmenu",function(e){if("VIDEO"===e.target.tagName)return e.preventDefault(),!1}),document.addEventListener("dragstart",function(e){if("VIDEO"===e.target.tagName)return e.preventDefault(),!1})},500)}let a="knxy",r=[];function l(e,t=!1){let i=document.getElementById("videos-list");if(i.innerHTML="",i.style.animation="none",i,i.style.animation="fadeInScale 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)",t||(a=e,r=[]),o[e]&&0!==o[e].length){0<r.length&&((t=document.createElement("div")).className="video-item folder-item back-folder",t.innerHTML=`
                    <div class="thumbnail">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='124' viewBox='0 0 220 124'%3E%3Crect width='220' height='124' fill='%231a1a2e'/%3E%3C/svg%3E" 
                             data-src="./img/back.jpg" 
                             alt="返回上一级" 
                             class="lazyload">
                        <div class="folder-icon"><svg class="svg-icon"><use href="#icon-arrow-left"></use></svg></div>
                    </div>
                    <div class="video-title">返回上一级</div>
                `,i.appendChild(t)),o[e].forEach((e,t)=>{var n=document.createElement("div"),e=(e.isFolder?(n.className="video-item folder-item",n.dataset.id=e.id,n.dataset.folderId=e.folderId,n.dataset.thumb=e.thumb,n.innerHTML=`
                        <div class="thumbnail">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='124' viewBox='0 0 220 124'%3E%3Crect width='220' height='124' fill='%231a1a2e'/%3E%3C/svg%3E" 
                                 data-src="${e.thumb}" 
                                 alt="${e.title}" 
                                 class="lazyload">
                            <div class="folder-icon"><svg class="svg-icon"><use href="#icon-folder-open"></use></svg></div>
                        </div>
                        <div class="video-title">${e.title}</div>
                    `):(n.className="video-item",n.dataset.id=e.id,n.dataset.url=e.url,n.dataset.thumb=e.thumb,n.innerHTML=`
                        <div class="thumbnail">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='124' viewBox='0 0 220 124'%3E%3Crect width='220' height='124' fill='%231a1a2e'/%3E%3C/svg%3E" 
                                 data-src="${e.thumb}" 
                                 alt="${e.title}" 
                                 class="lazyload">
                            <div class="play-icon"><svg class="svg-icon"><use href="#icon-play"></use></svg></div>
                        </div>
                        <div class="video-title">${e.title}</div>
                    `),t%12*.1+.1);n.style.animationDelay=e+"s",i.appendChild(n)});{let e=document.querySelectorAll("img.lazyload"),t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&((e=e.target).src=e.dataset.src,e.classList.remove("lazyload"),t.unobserve(e))})},{rootMargin:"200px 0px"});e.forEach(e=>t.observe(e))}}else i.innerHTML=`
                    <div class="no-videos">
                        <svg class="svg-icon"><use href="#icon-video-slash"></use></svg>
                        <div>此分类下暂无视频内容</div>
                    </div>
                `}function m(e,t=""){if(e)if(s===e)d.play();else{s=e;let o=setTimeout(()=>{v("视频加载时间较长，请耐心等待")},15e3);try{var n=c(),i=(n&&n.video&&(n.destroy(),d=null),/iPad|iPhone|iPod/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&1<navigator.maxTouchPoints),a=e.toLowerCase().endsWith(".mp4");if(i)if(a||!Hls.isSupported())clearTimeout(o),/iPad|iPhone|iPod/.test(navigator.userAgent)&&window.MSStream,d=new DPlayer({container:document.getElementById("dplayer-container"),contextmenu:[],video:{url:e,pic:t,type:"auto"},autoplay:!0,autoHide:!0,hideControlsAfter:3e3}),u(),d.on("play",function(){setTimeout(function(){var e;document.getElementById("dplayer-container").classList.add("dplayer-hide-controller"),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&(e=document.querySelector(".dplayer-video-current"))&&g(e)},1e3)});else{let n=new Hls({enableWorker:!1,maxBufferLength:30,lowLatencyMode:!1});n.loadSource(e),n.attachMedia(document.createElement("video")),n.on(Hls.Events.MANIFEST_PARSED,()=>{clearTimeout(o);/iPad|iPhone|iPod/.test(navigator.userAgent)&&window.MSStream;d=new DPlayer({container:document.getElementById("dplayer-container"),contextmenu:[],video:{url:e,pic:t,type:"customHls",customType:{customHls:function(e,t){n.attachMedia(e)}}},autoplay:!0,autoHide:!0,hideControlsAfter:3e3}),u(),d.on("play",function(){setTimeout(function(){var e;document.getElementById("dplayer-container").classList.add("dplayer-hide-controller"),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&(e=document.querySelector(".dplayer-video-current"))&&g(e)},1e3)})}),void n.on(Hls.Events.ERROR,(e,t)=>{console.error("HLS 错误:",t),clearTimeout(o)})}else{/iPad|iPhone|iPod/.test(navigator.userAgent)&&window.MSStream;d=new DPlayer({container:document.getElementById("dplayer-container"),contextmenu:[],video:{url:e,pic:t,type:e.toLowerCase().endsWith(".m3u8")||e.toLowerCase().endsWith(".js")?"hls":"auto"},hls:{liveSyncDurationCount:3,maxMaxBufferLength:30,enableWorker:!0},autoHide:!0,hideControlsAfter:3e3,errorHandler:function(e){console.error("播放错误:",e),v("视频播放失败，请重试"),clearTimeout(o)}});let n=!1,i=0;if(u(),d.on("canplay",function(){if(clearTimeout(o),document.getElementById("compatibility-alert").style.display="none",setTimeout(()=>{var e;d.controller.hide(),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&(e=document.querySelector(".dplayer-video-current"))&&g(e)},100),!n){var t=d.video.duration;i=t;let e=setInterval(()=>{d.video.duration!==i?i=d.video.duration:(updateDurationDisplay(i),n=!0,clearInterval(e))},500)}}),d.on("error",function(){clearTimeout(o)}),d.play(),d&&!(768<window.innerWidth)){var r=document.getElementById("dplayer-container");let e;var l=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;r.addEventListener("touchstart",function(){clearTimeout(e),e=setTimeout(()=>{d&&!d.video.paused&&d.controller.hide()},3e3)}),l&&((r=document.querySelector(".dplayer-video-current"))&&r.addEventListener("click",function(){clearTimeout(e),e=setTimeout(()=>{d&&!d.video.paused&&d.controller.hide()},3e3)}),document.addEventListener("touchend",function(){d&&!d.video.paused&&(clearTimeout(e),e=setTimeout(()=>{d.controller.hide()},3e3))}))}}}catch(e){console.error("播放错误:",e),v("视频播放失败: "+e.message),clearTimeout(o)}}else v("此视频源不可用，请选择其他视频")}function v(e){let t=document.getElementById("compatibility-alert");document.getElementById("compatibility-message").textContent=e,t.style.display="flex",setTimeout(()=>{t.style.display="none"},3e3)}function g(e){if(d&&e){let t;e.addEventListener("click",function(){clearTimeout(t),t=setTimeout(()=>{d&&!d.video.paused&&d.controller.hide()},3e3)}),new MutationObserver(function(e){e.forEach(function(e){"class"===e.attributeName&&(clearTimeout(t),t=setTimeout(()=>{d&&!d.video.paused&&d.controller.hide()},3e3))})}).observe(document.querySelector(".dplayer"),{attributes:!0})}}{c();{let o=document.getElementById("categories-container");o.innerHTML="",t.forEach(e=>{var t=document.createElement("button"),n=(t.className="category-btn",t.dataset.category=e.id,document.createElementNS("http://www.w3.org/2000/svg","svg")),i=(n.setAttribute("class","svg-icon"),n.setAttribute("viewBox","0 0 24 24"),document.createElementNS("http://www.w3.org/2000/svg","use")),i=(i.setAttributeNS("http://www.w3.org/1999/xlink","href",e.icon),n.appendChild(i),t.appendChild(n),document.createTextNode(" "+e.name));t.appendChild(i),"knxy"===e.id&&t.classList.add("active"),o.appendChild(t)})}setTimeout(()=>{l("knxy")},100),document.createElement("video").canPlayType("application/vnd.apple.mpegurl")||Hls.isSupported()||v("您的设备可能需要JavaScript兼容模式播放视频"),document.getElementById("categories-container").addEventListener("click",e=>{e=e.target.closest(".category-btn");e&&(document.querySelectorAll(".category-btn.active").forEach(e=>e.classList.remove("active")),e.classList.add("active"),l(e.dataset.category))}),document.getElementById("videos-list").addEventListener("click",e=>{var t,e=e.target.closest(".video-item");e&&(e.classList.contains("back-folder")?0<r.length?l(r.pop(),!0):l(a):e.classList.contains("folder-item")?(t=e.dataset.folderId)&&o[t]&&(r.push(a),l(t,!0)):m(e.dataset.url,e.querySelector("img").dataset.src,e.querySelector(".video-title").textContent))});let n=document.getElementById("comments-toggle-btn"),i=document.getElementById("waline"),e=(n&&i&&(i.classList.add("show"),n.childNodes[2].textContent=" 收起留言板 ",n.classList.add("active"),i.style.display="block",n.addEventListener("click",function(){var e=!i.classList.contains("show"),t=n.childNodes[2];e?(i.classList.add("show"),i.style.display="block",t.textContent=" 收起留言板 ",n.classList.add("active"),window.walineInitialized||(window.walineInitialized=!0)):(i.classList.remove("show"),t.textContent=" 展开留言板 ",n.classList.remove("active"),setTimeout(()=>{i.classList.contains("show")||(i.style.display="none")},800))})),document.getElementById("back-to-top"));e&&(window.addEventListener("scroll",function(){300<window.scrollY?e.classList.add("visible"):e.classList.remove("visible")}),e.addEventListener("click",function(){window.scrollTo({top:0,behavior:"smooth"})}),e.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),window.scrollTo({top:0,behavior:"smooth"}))}))}}function updateDurationDisplay(e){}function formatTime(e){var t;return isNaN(e)?"00:00":(t=Math.floor(e/60),e=Math.floor(e%60),t.toString().padStart(2,"0")+":"+e.toString().padStart(2,"0"))}window.addEventListener("DOMContentLoaded",function(){function e(e,t){var n=document.createElement("script");n.src=e,n.defer=!0,n.onload=t,document.body.appendChild(n)}e("js/videoData.js?t=20251009",function(){e("lib/hls.min.js",function(){Hls.isSupported()&&(Hls.DefaultConfig.enableWorker=!0,Hls.DefaultConfig.enableStreaming=!0,Hls.DefaultConfig.maxBufferLength=30,Hls.DefaultConfig.maxMaxBufferLength=60,Hls.DefaultConfig.liveSyncDurationCount=3),e("lib/DPlayer.min.js",initializeApp)})})});