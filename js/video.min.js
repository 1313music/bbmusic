function initializeApp(){a();const e=window.videoData||{},t=window.categories||[];let n=null,o="";function i(){return n||(n=new DPlayer({container:document.getElementById("dplayer-container"),live:!1,autoplay:!1,theme:"#d4af37",loop:!1,lang:"zh-cn",hotkey:!0,volume:.7,playbackSpeed:[.5,.75,1,1.25,1.5,2],mutex:!0,contextmenu:[],video:{url:"",pic:"https://v.1701701.xyz/img/bg.jpg"},errorHandler:function(e){console.error("DPlayer error:",e),c("视频播放失败: "+e.message)},mobileControls:!0,hideControlsAfter:1e3,autoHide:!0}),a(),setTimeout(()=>{n&&n.controller&&n.controller.hide()},1e3),n)}function a(){setTimeout(()=>{const e=document.getElementById("dplayer-container");e&&e.addEventListener("contextmenu",function(e){return e.preventDefault(),!1});document.querySelectorAll("video").forEach(e=>{e.addEventListener("contextmenu",function(e){return e.preventDefault(),!1}),e.addEventListener("dragstart",function(e){return e.preventDefault(),!1})}),document.addEventListener("contextmenu",function(e){if("VIDEO"===e.target.tagName)return e.preventDefault(),!1}),document.addEventListener("dragstart",function(e){if("VIDEO"===e.target.tagName)return e.preventDefault(),!1})},500)}let r="knxy",s=[];function d(t,n=!1){const o=document.getElementById("videos-list");if(o.innerHTML="",o.style.animation="none",o.offsetHeight,o.style.animation="fadeInScale 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)",n||(r=t,s=[]),e[t]&&0!==e[t].length){if(s.length>0){const e=document.createElement("div");e.className="video-item folder-item back-folder",e.innerHTML='\n                    <div class="thumbnail">\n                        <img src="data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'220\' height=\'124\' viewBox=\'0 0 220 124\'%3E%3Crect width=\'220\' height=\'124\' fill=\'%231a1a2e\'/%3E%3C/svg%3E" \n                             data-src="./img/back.jpg" \n                             alt="返回上一级" \n                             class="lazyload">\n                        <div class="folder-icon"><svg class="svg-icon"><use href="#icon-arrow-left"></use></svg></div>\n                    </div>\n                    <div class="video-title">返回上一级</div>\n                ',o.appendChild(e)}e[t].forEach((e,t)=>{const n=document.createElement("div");e.isFolder?(n.className="video-item folder-item",n.dataset.id=e.id,n.dataset.folderId=e.folderId,n.dataset.thumb=e.thumb,n.innerHTML=`\n                        <div class="thumbnail">\n                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='124' viewBox='0 0 220 124'%3E%3Crect width='220' height='124' fill='%231a1a2e'/%3E%3C/svg%3E" \n                                 data-src="${e.thumb}" \n                                 alt="${e.title}" \n                                 class="lazyload">\n                            <div class="folder-icon"><svg class="svg-icon"><use href="#icon-folder-open"></use></svg></div>\n                        </div>\n                        <div class="video-title">${e.title}</div>\n                    `):(n.className="video-item",n.dataset.id=e.id,n.dataset.url=e.url,n.dataset.thumb=e.thumb,n.innerHTML=`\n                        <div class="thumbnail">\n                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='124' viewBox='0 0 220 124'%3E%3Crect width='220' height='124' fill='%231a1a2e'/%3E%3C/svg%3E" \n                                 data-src="${e.thumb}" \n                                 alt="${e.title}" \n                                 class="lazyload">\n                            <div class="play-icon"><svg class="svg-icon"><use href="#icon-play"></use></svg></div>\n                        </div>\n                        <div class="video-title">${e.title}</div>\n                    `);const i=t%12*.1+.1;n.style.animationDelay=`${i}s`,o.appendChild(n)}),function(){const e=document.querySelectorAll("img.lazyload"),t=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const n=e.target;n.src=n.dataset.src,n.classList.remove("lazyload"),t.unobserve(n)}})},{rootMargin:"200px 0px"});e.forEach(e=>t.observe(e))}()}else o.innerHTML='\n                    <div class="no-videos">\n                        <svg class="svg-icon"><use href="#icon-video-slash"></use></svg>\n                        <div>此分类下暂无视频内容</div>\n                    </div>\n                '}function l(e,t="",r="精彩视频"){if(!e)return void c("此视频源不可用，请选择其他视频");if(o===e)return void n.play();o=e;const s=setTimeout(()=>{c("视频加载时间较长，请耐心等待")},15e3);try{const o=i();o&&o.video&&(o.destroy(),n=null);const r=/iPad|iPhone|iPod/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,d=e.toLowerCase().endsWith(".mp4");if(r){if(!d&&Hls.isSupported()){const o=new Hls({enableWorker:!1,maxBufferLength:30,lowLatencyMode:!1});return o.loadSource(e),o.attachMedia(document.createElement("video")),o.on(Hls.Events.MANIFEST_PARSED,()=>{clearTimeout(s);/iPad|iPhone|iPod/.test(navigator.userAgent)&&window.MSStream;n=new DPlayer({container:document.getElementById("dplayer-container"),contextmenu:[],video:{url:e,pic:t,type:"customHls",customType:{customHls:function(e,t){o.attachMedia(e)}}},autoplay:!0,autoHide:!0,hideControlsAfter:3e3}),a(),n.on("play",function(){setTimeout(function(){document.getElementById("dplayer-container").classList.add("dplayer-hide-controller");if(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream){const e=document.querySelector(".dplayer-video-current");e&&u(e)}},1e3)})}),void o.on(Hls.Events.ERROR,(e,t)=>{console.error("HLS 错误:",t),clearTimeout(s)})}clearTimeout(s);/iPad|iPhone|iPod/.test(navigator.userAgent)&&window.MSStream;return n=new DPlayer({container:document.getElementById("dplayer-container"),contextmenu:[],video:{url:e,pic:t,type:"auto"},autoplay:!0,autoHide:!0,hideControlsAfter:3e3}),a(),void n.on("play",function(){setTimeout(function(){document.getElementById("dplayer-container").classList.add("dplayer-hide-controller");if(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream){const e=document.querySelector(".dplayer-video-current");e&&u(e)}},1e3)})}/iPad|iPhone|iPod/.test(navigator.userAgent)&&window.MSStream;n=new DPlayer({container:document.getElementById("dplayer-container"),contextmenu:[],video:{url:e,pic:t,type:e.toLowerCase().endsWith(".m3u8")||e.toLowerCase().endsWith(".js")?"hls":"auto"},hls:{liveSyncDurationCount:3,maxMaxBufferLength:30,enableWorker:!0},autoHide:!0,hideControlsAfter:3e3,errorHandler:function(e){console.error("播放错误:",e),c("视频播放失败，请重试"),clearTimeout(s)}});let l=!1,m=0;a(),n.on("canplay",function(){if(clearTimeout(s),document.getElementById("compatibility-alert").style.display="none",setTimeout(()=>{n.controller.hide();if(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream){const e=document.querySelector(".dplayer-video-current");e&&u(e)}},100),!l){const e=n.video.duration;m=e;const t=setInterval(()=>{n.video.duration!==m?m=n.video.duration:(updateDurationDisplay(m),l=!0,clearInterval(t))},500)}}),n.on("error",function(){clearTimeout(s)}),n.play(),function(){if(!n||window.innerWidth>768)return;const e=document.getElementById("dplayer-container");let t;const o=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;if(e.addEventListener("touchstart",function(){clearTimeout(t),t=setTimeout(()=>{n&&!n.video.paused&&n.controller.hide()},3e3)}),o){const e=document.querySelector(".dplayer-video-current");e&&e.addEventListener("click",function(){clearTimeout(t),t=setTimeout(()=>{n&&!n.video.paused&&n.controller.hide()},3e3)}),document.addEventListener("touchend",function(){n&&!n.video.paused&&(clearTimeout(t),t=setTimeout(()=>{n.controller.hide()},3e3))})}}()}catch(e){console.error("播放错误:",e),c("视频播放失败: "+e.message),clearTimeout(s)}}function c(e){const t=document.getElementById("compatibility-alert");document.getElementById("compatibility-message").textContent=e,t.style.display="flex",setTimeout(()=>{t.style.display="none"},3e3)}function u(e){if(!n||!e)return;let t;e.addEventListener("click",function(){clearTimeout(t),t=setTimeout(()=>{n&&!n.video.paused&&n.controller.hide()},3e3)});new MutationObserver(function(e){e.forEach(function(e){"class"===e.attributeName&&(clearTimeout(t),t=setTimeout(()=>{n&&!n.video.paused&&n.controller.hide()},3e3))})}).observe(document.querySelector(".dplayer"),{attributes:!0})}!function(){i(),function(){const e=document.getElementById("categories-container");e.innerHTML="",t.forEach(t=>{const n=document.createElement("button");n.className="category-btn",n.dataset.category=t.id;const o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("class","svg-icon"),o.setAttribute("viewBox","0 0 24 24");const i=document.createElementNS("http://www.w3.org/2000/svg","use");i.setAttributeNS("http://www.w3.org/1999/xlink","href",t.icon),o.appendChild(i),n.appendChild(o);const a=document.createTextNode(` ${t.name}`);n.appendChild(a),"knxy"===t.id&&n.classList.add("active"),e.appendChild(n)})}(),setTimeout(()=>{d("knxy")},100),document.createElement("video").canPlayType("application/vnd.apple.mpegurl")||Hls.isSupported()||c("您的设备可能需要JavaScript兼容模式播放视频"),document.getElementById("categories-container").addEventListener("click",e=>{const t=e.target.closest(".category-btn");t&&(document.querySelectorAll(".category-btn.active").forEach(e=>e.classList.remove("active")),t.classList.add("active"),d(t.dataset.category))}),document.getElementById("videos-list").addEventListener("click",t=>{const n=t.target.closest(".video-item");if(!n)return;if(n.classList.contains("back-folder")){if(s.length>0){d(s.pop(),!0)}else d(r);return}if(n.classList.contains("folder-item")){const t=n.dataset.folderId;return void(t&&e[t]&&(s.push(r),d(t,!0)))}l(n.dataset.url,n.querySelector("img").dataset.src,n.querySelector(".video-title").textContent)});const n=document.getElementById("back-to-top");n&&(window.addEventListener("scroll",function(){window.scrollY>300?n.classList.add("visible"):n.classList.remove("visible")}),n.addEventListener("click",function(){window.scrollTo({top:0,behavior:"smooth"})}),n.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),window.scrollTo({top:0,behavior:"smooth"}))}))}()}function updateDurationDisplay(e){}function formatTime(e){if(isNaN(e))return"00:00";const t=Math.floor(e/60),n=Math.floor(e%60);return`${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}window.addEventListener("DOMContentLoaded",function(){function e(e,t){const n=document.createElement("script");n.src=e,n.defer=!0,n.onload=t,document.body.appendChild(n)}e("js/videoData.js?t=2025100101",function(){e("lib/hls.min.js",function(){Hls.isSupported()&&(Hls.DefaultConfig.enableWorker=!0,Hls.DefaultConfig.enableStreaming=!0,Hls.DefaultConfig.maxBufferLength=30,Hls.DefaultConfig.maxMaxBufferLength=60,Hls.DefaultConfig.liveSyncDurationCount=3),e("lib/DPlayer.min.js",initializeApp)})})});